exports.id=802,exports.ids=[802],exports.modules={1903:(a,b,c)=>{"use strict";var d=c(27910).Stream,e=c(28354),f=c(94519),g=c(15554),h=c(99826),i=c(78829),j=c(50501),k=function(a,b,c){this.writable=!0,c=c||{},this._stream=b.socket,this._ping=c.ping||this.DEFAULT_PING,this._retry=c.retry||this.DEFAULT_RETRY;var d=f.isSecureRequest(a)?"https:":"http:";this.url=d+"//"+a.headers.host+a.url,this.lastEventId=a.headers["last-event-id"]||"",this.readyState=h.CONNECTING;var e=new g,i=this;if(c.headers)for(var j in c.headers)e.set(j,c.headers[j]);if(this._stream&&this._stream.writable){process.nextTick(function(){i._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var k="HTTP/1.1 200 OK\r\nContent-Type: text/event-stream\r\nCache-Control: no-cache, no-store\r\nConnection: close\r\n"+e.toString()+"\r\nretry: "+Math.floor(1e3*this._retry)+"\r\n\r\n";this._write(k),this._stream.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i.ping()},1e3*this._ping)),["error","end"].forEach(function(a){i._stream.on(a,function(){i.close()})})}};e.inherits(k,d),k.isEventSource=function(a){return"GET"===a.method&&(a.headers.accept||"").split(/\s*,\s*/).indexOf("text/event-stream")>=0};var l={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(a){if(!this.writable)return!1;try{return this._stream.write(a,"utf8")}catch(a){return!1}},_open:function(){if(this.readyState===h.CONNECTING){this.readyState=h.OPEN;var a=new j("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.write(a),this.close()},send:function(a,b){if(this.readyState>h.OPEN)return!1;a=String(a).replace(/(\r\n|\r|\n)/g,"$1data: ");var c="";return(b=b||{}).event&&(c+="event: "+b.event+"\r\n"),b.id&&(c+="id: "+b.id+"\r\n"),c+="data: "+a+"\r\n\r\n",this._write(c)},ping:function(){return this._write(":\r\n\r\n")},close:function(){if(this.readyState>h.OPEN)return!1;this.readyState=h.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var a=new j("close");return a.initEvent("close",!1,!1),this.dispatchEvent(a),!0}};for(var m in l)k.prototype[m]=l[m];for(var n in i)k.prototype[n]=i[n];a.exports=k},4717:a=>{"use strict";var b=function(a){this._bufferSize=a,this.clear()};b.prototype.clear=function(){this._buffer=Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0},b.prototype.push=function(a){var b=!1,c=!1;this._ringSize<this._bufferSize?b=0===this._tail:this._ringOffset===this._ringSize&&(b=!0,c=0===this._tail),b&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(Array(this._bufferSize)),this._bufferSize=this._buffer.length,c&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=a,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize},b.prototype.peek=function(){if(0!==this.length)return this._buffer[this._head]},b.prototype.shift=function(){if(0!==this.length){var a=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,0===this._ringOffset&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,a}},a.exports=b},5321:(a,b)=>{function c(a){if(void 0!==a&&a!==c.REQUEST&&a!==c.RESPONSE)throw Error("type must be REQUEST or RESPONSE");void 0===a||this.initialize(a),this.maxHeaderSize=c.maxHeaderSize}b.e=c,c.prototype.initialize=function(a,b){if(a!==c.REQUEST&&a!==c.RESPONSE)throw Error("type must be REQUEST or RESPONSE");this.type=a,this.state=a+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1},c.encoding="ascii",c.maxHeaderSize=81920,c.REQUEST="REQUEST",c.RESPONSE="RESPONSE";var d=c.kOnHeaders=1,e=c.kOnHeadersComplete=2,f=c.kOnBody=3,g=c.kOnMessageComplete=4;c.prototype[d]=c.prototype[e]=c.prototype[f]=c.prototype[g]=function(){};var h=!0;Object.defineProperty(c,"kOnExecute",{get:function(){return h=!1,99}});var i=c.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],j=i.indexOf("CONNECT");c.prototype.reinitialize=c,c.prototype.close=c.prototype.pause=c.prototype.resume=c.prototype.remove=c.prototype.free=function(){},c.prototype._compatMode0_11=!1,c.prototype.getAsyncId=function(){return 0};var k={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};c.prototype.execute=function(a,b,d){if(!(this instanceof c))throw TypeError("not a HTTPParser");b=b||0,d="number"==typeof d?d:a.length,this.chunk=a,this.offset=b;var e=this.end=b+d;try{for(;this.offset<e&&!this[this.state](););}catch(a){if(this.isUserCall)throw a;return this.hadError=!0,a}return(this.chunk=null,d=this.offset-b,k[this.state]&&(this.headerSize+=d,this.headerSize>(this.maxHeaderSize||c.maxHeaderSize)))?Error("max header size exceeded"):d};var l={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};c.prototype.finish=function(){if(!this.hadError){if(!l[this.state])return Error("invalid state for EOF");"BODY_RAW"===this.state&&this.userCall()(this[g]())}},c.prototype.consume=c.prototype.unconsume=c.prototype.getCurrentBuffer=function(){},c.prototype.userCall=function(){this.isUserCall=!0;var a=this;return function(b){return a.isUserCall=!1,b}},c.prototype.nextRequest=function(){this.userCall()(this[g]()),this.reinitialize(this.type)},c.prototype.consumeLine=function(){for(var a=this.end,b=this.chunk,d=this.offset;d<a;d++)if(10===b[d]){var e=this.line+b.toString(c.encoding,this.offset,d);return"\r"===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),this.line="",this.offset=d+1,e}this.line+=b.toString(c.encoding,this.offset,this.end),this.offset=this.end};var m=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,n=/^[ \t]+(.*[^ \t])/;c.prototype.parseHeader=function(a,b){if(-1!==a.indexOf("\r"))throw q("HPE_LF_EXPECTED");var c=m.exec(a),d=c&&c[1];if(d)b.push(d),b.push(c[2]);else{var e=n.exec(a);e&&b.length&&(b[b.length-1]&&(b[b.length-1]+=" "),b[b.length-1]+=e[1])}};var o=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;c.prototype.REQUEST_LINE=function(){var a=this.consumeLine();if(a){var b=o.exec(a);if(null===b)throw q("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?b[1]:i.indexOf(b[1]),-1===this.info.method)throw Error("invalid request method");this.info.url=b[2],this.info.versionMajor=+b[3],this.info.versionMinor=+b[4],this.body_bytes=0,this.state="HEADER"}};var p=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;function q(a){var b=Error("Parse Error");return b.code=a,b}c.prototype.RESPONSE_LINE=function(){var a=this.consumeLine();if(a){var b=p.exec(a);if(null===b)throw q("HPE_INVALID_CONSTANT");this.info.versionMajor=+b[1],this.info.versionMinor=+b[2];var c=this.info.statusCode=+b[3];this.info.statusMessage=b[4],((c/100|0)==1||204===c||304===c)&&(this.body_bytes=0),this.state="HEADER"}},c.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(-1!==this.connection.indexOf("close"))return!1}else if(-1===this.connection.indexOf("keep-alive"))return!1;return null!==this.body_bytes||!!this.isChunked},c.prototype.HEADER=function(){var a=this.consumeLine();if(void 0!==a){var b=this.info;if(a)this.parseHeader(a,b.headers);else{for(var d,f,g=b.headers,i=!1,k=!1,l=0;l<g.length;l+=2)switch(g[l].toLowerCase()){case"transfer-encoding":this.isChunked="chunked"===g[l+1].toLowerCase();break;case"content-length":if(d=+g[l+1],i){if(d!==this.body_bytes)throw q("HPE_UNEXPECTED_CONTENT_LENGTH")}else i=!0,this.body_bytes=d;break;case"connection":this.connection+=g[l+1].toLowerCase();break;case"upgrade":k=!0}if(this.isChunked&&i&&(i=!1,this.body_bytes=null),k&&-1!=this.connection.indexOf("upgrade")?b.upgrade=this.type===c.REQUEST||101===b.statusCode:b.upgrade=b.method===j,this.isChunked&&b.upgrade&&(this.isChunked=!1),b.shouldKeepAlive=this.shouldKeepAlive(),2===(f=h?this.userCall()(this[e](b)):this.userCall()(this[e](b.versionMajor,b.versionMinor,b.headers,b.method,b.url,b.statusCode,b.statusMessage,b.upgrade,b.shouldKeepAlive))))return this.nextRequest(),!0;if(this.isChunked&&!f)this.state="BODY_CHUNKHEAD";else{if(f||0===this.body_bytes)return this.nextRequest(),b.upgrade;null===this.body_bytes?this.state="BODY_RAW":this.state="BODY_SIZED"}}}},c.prototype.BODY_CHUNKHEAD=function(){var a=this.consumeLine();void 0!==a&&(this.body_bytes=parseInt(a,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")},c.prototype.BODY_CHUNK=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[f](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")},c.prototype.BODY_CHUNKEMPTYLINE=function(){var a=this.consumeLine();if(void 0!==a){if(""!==a)throw Error("Expected empty line");this.state="BODY_CHUNKHEAD"}},c.prototype.BODY_CHUNKTRAILERS=function(){var a=this.consumeLine();void 0!==a&&(a?this.parseHeader(a,this.trailers):(this.trailers.length&&this.userCall()(this[d](this.trailers,"")),this.nextRequest()))},c.prototype.BODY_RAW=function(){this.userCall()(this[f](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end},c.prototype.BODY_SIZED=function(){var a=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[f](this.chunk.slice(this.offset,this.offset+a),0,a)),this.offset+=a,this.body_bytes-=a,this.body_bytes||this.nextRequest()},["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(a){var b=c["kOn"+a];Object.defineProperty(c.prototype,"on"+a,{get:function(){return this[b]},set:function(a){return this._compatMode0_11=!0,j="CONNECT",this[b]=a}})})},6094:(a,b,c)=>{"use strict";var d=c(62253).Buffer,e=c(28647),f=c(93867),g=c(55511),h=c(28354),i=function(a){return parseInt((a.match(/[0-9]/g)||[]).join(""),10)},j=function(a){return(a.match(/ /g)||[]).length},k=function(a,b,c){f.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};h.inherits(k,f);var l={BODY_SIZE:8,start:function(){return!!f.prototype.start.call(this)&&(this._started=!0,this._sendHandshakeBody(),!0)},close:function(){return 3!==this.readyState&&(1===this.readyState&&this._write(d.from([255,0])),this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,b=a["sec-websocket-key1"],c=a["sec-websocket-key2"];if(!b)throw Error("Missing required header: Sec-WebSocket-Key1");if(!c)throw Error("Missing required header: Sec-WebSocket-Key2");var e=i(b),f=j(b),g=i(c),h=j(c);if(e%f!=0||g%h!=0)throw Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[e/f,g/h];var a=["HTTP/1.1 101 WebSocket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var a=g.createHash("md5"),b=d.allocUnsafe(8+this.BODY_SIZE);return b.writeUInt32BE(this._keyValues[0],0),b.writeUInt32BE(this._keyValues[1],4),d.from(this._body).copy(b,8,0,this.BODY_SIZE),a.update(b),d.from(a.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var a=this._handshakeSignature();a&&(this._write(a),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(a){if(255!==a)return f.prototype._parseLeadingByte.call(this,a);this._closing=!0,this._length=0,this._stage=1}};for(var m in l)k.prototype[m]=l[m];a.exports=k},9757:(a,b,c)=>{"use strict";var d=c(28354),e=c(94519),f=c(99826),g=function(a,b,c,d,g){g=g||{},this._stream=b,this._driver=e.http(a,{maxLength:g.maxLength,protocols:d});var h=this;if(this._stream&&this._stream.writable){if(!this._stream.readable)return this._stream.end();var i=function(){h._stream.removeListener("data",i)};this._stream.on("data",i),f.call(this,g),process.nextTick(function(){h._driver.start(),h._driver.io.write(c)})}};d.inherits(g,f),g.isWebSocket=function(a){return e.isWebSocket(a)},g.validateOptions=function(a,b){e.validateOptions(a,b)},g.WebSocket=g,g.Client=c(63995),g.EventSource=c(1903),a.exports=g},13166:(a,b,c)=>{"use strict";var d=c(69727),e=c(95599),f=function(a){this._ext=a[0],this._session=a[1],this._functors={incoming:new d(this._session,"processIncomingMessage"),outgoing:new d(this._session,"processOutgoingMessage")}};f.prototype.pending=function(a){var b=this._functors[a];b._stopped||(b.pending+=1)},f.prototype.incoming=function(a,b,c,d){this._exec("incoming",a,b,c,d)},f.prototype.outgoing=function(a,b,c,d){this._exec("outgoing",a,b,c,d)},f.prototype.close=function(){return this._closed=this._closed||new e,this._doClose(),this._closed},f.prototype._exec=function(a,b,c,d,e){this._functors[a].call(b,c,function(a,b){a&&(a.message=this._ext.name+": "+a.message),d.call(e,a,b),this._doClose()},this)},f.prototype._doClose=function(){var a=this._functors.incoming,b=this._functors.outgoing;this._closed&&a.pending+b.pending===0&&(this._session&&this._session.close(),this._session=null,this._closed.done())},a.exports=f},15554:a=>{"use strict";var b=function(){this.clear()};b.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"],b.prototype.clear=function(){this._sent={},this._lines=[]},b.prototype.set=function(a,b){if(void 0!==b){a=this._strip(a),b=this._strip(b);var c=a.toLowerCase();(!this._sent.hasOwnProperty(c)||this.ALLOWED_DUPLICATES.indexOf(c)>=0)&&(this._sent[c]=!0,this._lines.push(a+": "+b+"\r\n"))}},b.prototype.toString=function(){return this._lines.join("")},b.prototype._strip=function(a){return a.toString().replace(/^ */,"").replace(/ *$/,"")},a.exports=b},23444:(a,b,c)=>{"use strict";var d=c(62253).Buffer,e=c(27910).Stream,f=c(79551),g=c(28354),h=c(28647),i=c(15554),j=c(31531),k={"ws:":80,"wss:":443},l=function(a,b,c){this._client=a,this._http=new j("response"),this._origin="object"==typeof a.url?a.url:f.parse(a.url),this._url="object"==typeof b?b:f.parse(b),this._options=c||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new i,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var e=this._url.auth&&d.from(this._url.auth,"utf8").toString("base64");e&&this._headers.set("Proxy-Authorization","Basic "+e)};g.inherits(l,e);var m={setHeader:function(a,b){return 0===this._state&&(this._headers.set(a,b),!0)},start:function(){if(0!==this._state)return!1;this._state=1;var a=this._origin,b=a.port||k[a.protocol],c=["CONNECT "+a.hostname+":"+b+" HTTP/1.1",this._headers.toString(),""];return this.emit("data",d.from(c.join("\r\n"),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(a){if(!this.writable)return!1;if(this._http.parse(a),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,200===this.statusCode)this.emit("connect",new h.ConnectEvent);else{var b="Can't establish a connection to the server at "+this._origin.href;this.emit("error",Error(b))}return this.end(),!this._paused},end:function(a){this.writable&&(void 0!==a&&this.write(a),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(var n in m)l.prototype[n]=m[n];a.exports=l},28647:(a,b,c)=>{"use strict";var d=c(62253).Buffer,e=c(94735).EventEmitter,f=c(28354),g=c(63416),h=c(15554),i=c(77018),j=function(a,b,c){e.call(this),j.validateOptions(c||{},["maxLength","masking","requireMasking","protocols"]),this._request=a,this._reader=new i,this._options=c||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new h,this.__queue=[],this.readyState=0,this.url=b,this.io=new g.IO(this),this.messages=new g.Messages(this),this._bindEventListeners()};f.inherits(j,e),j.isWebSocket=function(a){var b=a.headers.connection||"",c=a.headers.upgrade||"";return"GET"===a.method&&b.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&"websocket"===c.toLowerCase()},j.validateOptions=function(a,b){for(var c in a)if(0>b.indexOf(c))throw Error("Unrecognized option: "+c)};var k={MAX_LENGTH:0x3ffffff,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var a=this;this.messages.on("error",function(){}),this.on("message",function(b){var c=a.messages;c.readable&&c.emit("data",b.data)}),this.on("error",function(b){var c=a.messages;c.readable&&c.emit("error",b)}),this.on("close",function(){var b=a.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(a){return!1},setHeader:function(a,b){return!(this.readyState>0)&&(this._headers.set(a,b),!0)},start:function(){var a;if(0!==this.readyState)return!1;if(!j.isWebSocket(this._request))return this._failHandshake(Error("Not a WebSocket request"));try{a=this._handshakeResponse()}catch(a){return this._failHandshake(a)}return this._write(a),-1!==this._stage&&this._open(),!0},_failHandshake:function(a){var b=new h;return b.set("Content-Type","text/plain"),b.set("Content-Length",d.byteLength(a.message,"utf8")),b=["HTTP/1.1 400 Bad Request",b.toString(),a.message],this._write(d.from(b.join("\r\n"),"utf8")),this._fail("protocol_error",a.message),!1},text:function(a){return this.frame(a)},binary:function(a){return!1},ping:function(){return!1},pong:function(){return!1},close:function(a,b){return 1===this.readyState&&(this.readyState=3,this.emit("close",new j.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(a){this.frame.apply(this,a)},this),this.__queue=[],this.emit("open",new j.OpenEvent)},_queue:function(a){return this.__queue.push(a),!0},_write:function(a){var b=this.io;b.readable&&b.emit("data",a)},_fail:function(a,b){this.readyState=2,this.emit("error",Error(b)),this.close()}};for(var l in k)j.prototype[l]=k[l];j.ConnectEvent=function(){},j.OpenEvent=function(){},j.CloseEvent=function(a,b){this.code=a,this.reason=b},j.MessageEvent=function(a){this.data=a},j.PingEvent=function(a){this.data=a},j.PongEvent=function(a){this.data=a},a.exports=j},31531:(a,b,c)=>{"use strict";var d=c(5321).e,e=c(62253).Buffer,f={request:d.REQUEST||"request",response:d.RESPONSE||"response"},g=function(a){this._type=a,this._parser=new d(f[a]),this._complete=!1,this.headers={};var b=null,c=this;this._parser.onHeaderField=function(a,c,d){b=a.toString("utf8",c,c+d).toLowerCase()},this._parser.onHeaderValue=function(a,d,e){var f=a.toString("utf8",d,d+e);c.headers.hasOwnProperty(b)?c.headers[b]+=", "+f:c.headers[b]=f},this._parser.onHeadersComplete=this._parser[d.kOnHeadersComplete]=function(a,b,d,e,f,h){var i=arguments[0];if("object"==typeof i&&(e=i.method,f=i.url,h=i.statusCode,d=i.headers),c.method="number"==typeof e?g.METHODS[e]:e,c.statusCode=h,c.url=f,d){for(var j,k,l=0,m=d.length;l<m;l+=2)j=d[l].toLowerCase(),k=d[l+1],c.headers.hasOwnProperty(j)?c.headers[j]+=", "+k:c.headers[j]=k;c._complete=!0}}};g.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var h=process.version?process.version.match(/[0-9]+/g).map(function(a){return parseInt(a,10)}):[];0===h[0]&&12===h[1]&&(g.METHODS[16]="REPORT",g.METHODS[17]="MKACTIVITY",g.METHODS[18]="CHECKOUT",g.METHODS[19]="MERGE",g.METHODS[20]="M-SEARCH",g.METHODS[21]="NOTIFY",g.METHODS[22]="SUBSCRIBE",g.METHODS[23]="UNSUBSCRIBE",g.METHODS[24]="PATCH",g.METHODS[25]="PURGE"),g.prototype.isComplete=function(){return this._complete},g.prototype.parse=function(a){var b=this._parser.execute(a,0,a.length);if("number"!=typeof b){this.error=b,this._complete=!0;return}this._complete&&(this.body=b<a.length?a.slice(b):e.alloc(0))},a.exports=g},31820:(a,b,c)=>{"use strict";var d=c(62253).Buffer,e=c(55511),f=c(28354),g=c(77335),h=c(28647),i=c(66186),j=c(56620),k=function(a,b,c){if(h.apply(this,arguments),this._extensions=new g,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},"string"==typeof this._protocols&&(this._protocols=this._protocols.split(/ *, */)),this._request){var d=this._request.headers["sec-websocket-protocol"],e=this._protocols;void 0!==d&&("string"==typeof d&&(d=d.split(/ *, */)),this.protocol=d.filter(function(a){return e.indexOf(a)>=0})[0]),this.version="hybi-"+k.VERSION}};f.inherits(k,h),k.VERSION="13",k.mask=function(a,b,c){if(!b||0===b.length)return a;c=c||0;for(var d=0,e=a.length-c;d<e;d++)a[c+d]=a[c+d]^b[d%4];return a},k.generateAccept=function(a){var b=e.createHash("sha1");return b.update(a+k.GUID),b.digest("base64")},k.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var l={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(a){return this._extensions.add(a),!0},parse:function(a){this._reader.put(a);for(var b=!0;b;)switch(this._stage){case 0:(b=this._reader.read(1))&&this._parseOpcode(b[0]);break;case 1:(b=this._reader.read(1))&&this._parseLength(b[0]);break;case 2:(b=this._reader.read(this._frame.lengthBytes))&&this._parseExtendedLength(b);break;case 3:(b=this._reader.read(4))&&(this._stage=4,this._frame.maskingKey=b);break;case 4:(b=this._reader.read(this._frame.length))&&(this._stage=0,this._emitFrame(b));break;default:b=null}},text:function(a){return!(this.readyState>1)&&this.frame(a,"text")},binary:function(a){return!(this.readyState>1)&&this.frame(a,"binary")},ping:function(a,b){return!(this.readyState>1)&&(a=a||"",b&&(this._pingCallbacks[a]=b),this.frame(a,"ping"))},pong:function(a){return!(this.readyState>1)&&(a=a||"",this.frame(a,"pong"))},close:function(a,b){return(a=a||"",b=b||this.ERRORS.normal_closure,this.readyState<=0)?(this.readyState=3,this.emit("close",new h.CloseEvent(b,a)),!0):1===this.readyState&&(this.readyState=2,this._extensions.close(function(){this.frame(a,"close",b)},this),!0)},frame:function(a,b,c){if(this.readyState<=0)return this._queue([a,b,c]);if(this.readyState>2)return!1;a instanceof Array&&(a=d.from(a)),"number"==typeof a&&(a=a.toString());var f,g,h=new j,k="string"==typeof a;h.rsv1=h.rsv2=h.rsv3=!1,h.opcode=this.OPCODES[b||(k?"text":"binary")],f=k?d.from(a,"utf8"):a,c&&(g=f,(f=d.allocUnsafe(2+g.length)).writeUInt16BE(c,0),g.copy(f,2)),h.data=f;var l=function(a){var b=new i;b.final=!0,b.rsv1=a.rsv1,b.rsv2=a.rsv2,b.rsv3=a.rsv3,b.opcode=a.opcode,b.masked=!!this._masking,b.length=a.data.length,b.payload=a.data,b.masked&&(b.maskingKey=e.randomBytes(4)),this._sendFrame(b)};return this.MESSAGE_OPCODES.indexOf(h.opcode)>=0?this._extensions.processOutgoingMessage(h,function(a,b){if(a)return this._fail("extension_error",a.message);l.call(this,b)},this):l.call(this,h),!0},_sendFrame:function(a){var b=a.length,c=b<=125?2:b<=65535?4:10,e=c+4*!!a.masked,f=d.allocUnsafe(e+b),g=a.masked?this.MASK:0;f[0]=(a.final?this.FIN:0)|(a.rsv1?this.RSV1:0)|(a.rsv2?this.RSV2:0)|(a.rsv3?this.RSV3:0)|a.opcode,b<=125?f[1]=g|b:b<=65535?(f[1]=126|g,f.writeUInt16BE(b,2)):(f[1]=127|g,f.writeUInt32BE(Math.floor(b/0x100000000),2),f.writeUInt32BE(b%0x100000000,6)),a.payload.copy(f,e),a.masked&&(a.maskingKey.copy(f,c),k.mask(f,a.maskingKey,e)),this._write(f)},_handshakeResponse:function(){var a=this._request.headers["sec-websocket-key"],b=this._request.headers["sec-websocket-version"];if(b!==k.VERSION)throw Error("Unsupported WebSocket version: "+b);if("string"!=typeof a)throw Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",k.generateAccept(a)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var c=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);c&&this._headers.set("Sec-WebSocket-Extensions",c);var e=["HTTP/1.1 101 Switching Protocols",this._headers.toString(),""];return d.from(e.join("\r\n"),"utf8")},_shutdown:function(a,b,c){delete this._frame,delete this._message,this._stage=5;var d=1===this.readyState;this.readyState=2,this._extensions.close(function(){d&&this.frame(b,"close",a),this.readyState=3,c&&this.emit("error",Error(b)),this.emit("close",new h.CloseEvent(a,b))},this)},_fail:function(a,b){this.readyState>1||this._shutdown(this.ERRORS[a],b,!0)},_parseOpcode:function(a){var b=[this.RSV1,this.RSV2,this.RSV3].map(function(b){return(a&b)===b}),c=this._frame=new i;return(c.final=(a&this.FIN)===this.FIN,c.rsv1=b[0],c.rsv2=b[1],c.rsv3=b[2],c.opcode=a&this.OPCODE,this._stage=1,this._extensions.validFrameRsv(c))?0>this.OPCODE_CODES.indexOf(c.opcode)?this._fail("protocol_error","Unrecognized frame opcode: "+c.opcode):0>this.MESSAGE_OPCODES.indexOf(c.opcode)&&!c.final?this._fail("protocol_error","Received fragmented control frame: opcode = "+c.opcode):this._message&&this.OPENING_OPCODES.indexOf(c.opcode)>=0?this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished"):void 0:this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+ +!!c.rsv1+", reserved2 = "+ +!!c.rsv2+", reserved3 = "+ +!!c.rsv3)},_parseLength:function(a){var b=this._frame;if(b.masked=(a&this.MASK)===this.MASK,b.length=a&this.LENGTH,b.length>=0&&b.length<=125){if(this._stage=b.masked?3:4,!this._checkFrameLength())return}else this._stage=2,b.lengthBytes=126===b.length?2:8;if(this._requireMasking&&!b.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(a){var b=this._frame;if(b.length=this._readUInt(a),this._stage=b.masked?3:4,0>this.MESSAGE_OPCODES.indexOf(b.opcode)&&b.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+b.length);if(!this._checkFrameLength())return},_checkFrameLength:function(){return!((this._message?this._message.length:0)+this._frame.length>this._maxLength)||(this._fail("too_large","WebSocket frame length too large"),!1)},_emitFrame:function(a){var b,c,d,e,f,g=this._frame,i=g.payload=k.mask(a,g.maskingKey),l=g.opcode;if(delete this._frame,l===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(g)}if((l===this.OPCODES.text||l===this.OPCODES.binary)&&(this._message=new j,this._message.pushFrame(g)),g.final&&this.MESSAGE_OPCODES.indexOf(l)>=0)return this._emitMessage(this._message);l===this.OPCODES.close&&(c=i.length>=2?i.readUInt16BE(0):null,d=i.length>2?this._encode(i.slice(2)):null,0!==i.length&&!(null!==c&&c>=this.MIN_RESERVED_ERROR&&c<=this.MAX_RESERVED_ERROR)&&0>this.ERROR_CODES.indexOf(c)&&(c=this.ERRORS.protocol_error),(i.length>125||i.length>2&&!d)&&(c=this.ERRORS.protocol_error),this._shutdown(c||this.DEFAULT_ERROR_CODE,d||"")),l===this.OPCODES.ping&&(this.frame(i,"pong"),this.emit("ping",new h.PingEvent(i.toString()))),l===this.OPCODES.pong&&(f=(e=this._pingCallbacks)[b=this._encode(i)],delete e[b],f&&f(),this.emit("pong",new h.PongEvent(i.toString())))},_emitMessage:function(a){var a=this._message;a.read(),delete this._message,this._extensions.processIncomingMessage(a,function(a,b){if(a)return this._fail("extension_error",a.message);var c=b.data;if(b.opcode===this.OPCODES.text&&(c=this._encode(c)),null===c)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new h.MessageEvent(c))},this)},_encode:function(a){try{var b=a.toString("binary",0,a.length);if(!this.UTF8_MATCH.test(b))return null}catch(a){}return a.toString("utf8",0,a.length)},_readUInt:function(a){return 2===a.length?a.readUInt16BE(0):0x100000000*a.readUInt32BE(0)+a.readUInt32BE(4)}};for(var m in l)k.prototype[m]=l[m];a.exports=k},33412:(a,b,c)=>{"use strict";var d=c(13166),e=c(95599),f=function(a){this._cells=a.map(function(a){return new d(a)}),this._stopped={incoming:!1,outgoing:!1}};f.prototype.processIncomingMessage=function(a,b,c){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,a,b,c)},f.prototype.processOutgoingMessage=function(a,b,c){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,a,b,c)},f.prototype.close=function(a,b){this._stopped={incoming:!0,outgoing:!0};var c=this._cells.map(function(a){return a.close()});a&&e.all(c).then(function(){a.call(b)})},f.prototype._loop=function(a,b,c,d,e,f,g){for(var h=this._cells,i=h.length,j=this;i--;)h[i].pending(a);var k=function(b,e,i){if(b===c)return f.call(g,e,i);h[b][a](e,i,function(c,e){c&&(j._stopped[a]=!0),k(b+d,c,e)})};k(b,null,e)},a.exports=f},34410:(a,b,c)=>{"use strict";c.d(b,{Dk:()=>d.Dk,Sx:()=>d.Sx,Wp:()=>d.Wp});var d=c(14186);(0,d.KO)("firebase","11.10.0","app")},40485:(a,b,c)=>{"use strict";var d=c(62253).Buffer,e=c(55511),f=c(79551),g=c(28354),h=c(31531),i=c(28647),j=c(31820),k=c(23444),l=function(a,b){this.version="hybi-"+j.VERSION,j.call(this,null,a,b),this.readyState=-1,this._key=l.generateKey(),this._accept=j.generateAccept(this._key),this._http=new h("response");var c=f.parse(this.url),e=c.auth&&d.from(c.auth,"utf8").toString("base64");if(0>this.VALID_PROTOCOLS.indexOf(c.protocol))throw Error(this.url+" is not a valid WebSocket URL");this._pathname=(c.pathname||"/")+(c.search||""),this._headers.set("Host",c.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",j.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),e&&this._headers.set("Authorization","Basic "+e)};g.inherits(l,j),l.generateKey=function(){return e.randomBytes(16).toString("base64")};var m={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(a,b){return new k(this,a,b)},start:function(){return -1===this.readyState&&(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(a){if(3!==this.readyState){if(this.readyState>0)return j.prototype.parse.call(this,a);this._http.parse(a),this._http.isComplete()&&(this._validateHandshake(),3!==this.readyState&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var a=this._extensions.generateOffer();a&&this._headers.set("Sec-WebSocket-Extensions",a);var b=["GET "+this._pathname+" HTTP/1.1",this._headers.toString(),""];return d.from(b.join("\r\n"),"utf8")},_failHandshake:function(a){a="Error during WebSocket handshake: "+a,this.readyState=3,this.emit("error",Error(a)),this.emit("close",new i.CloseEvent(this.ERRORS.protocol_error,a))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(101!==this._http.statusCode)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var a=this._http.headers,b=a.upgrade||"",c=a.connection||"",d=a["sec-websocket-accept"]||"",e=a["sec-websocket-protocol"]||"";if(""===b)return this._failHandshake("'Upgrade' header is missing");if("websocket"!==b.toLowerCase())return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(""===c)return this._failHandshake("'Connection' header is missing");if("upgrade"!==c.toLowerCase())return this._failHandshake("'Connection' header value is not 'Upgrade'");if(d!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,""!==e)if(0>this._protocols.indexOf(e))return this._failHandshake("Sec-WebSocket-Protocol mismatch");else this.protocol=e;try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(a){return this._failHandshake(a.message)}}};for(var n in m)l.prototype[n]=m[n];a.exports=l},50501:a=>{"use strict";var b=function(a,b){for(var c in this.type=a,b)this[c]=b[c]};b.prototype.initEvent=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c},b.prototype.stopPropagation=function(){},b.prototype.preventDefault=function(){},b.CAPTURING_PHASE=1,b.AT_TARGET=2,b.BUBBLING_PHASE=3,a.exports=b},56620:(a,b,c)=>{"use strict";var d=c(62253).Buffer,e=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},f={read:function(){return this.data=this.data||d.concat(this._chunks,this.length)},pushFrame:function(a){this.rsv1=this.rsv1||a.rsv1,this.rsv2=this.rsv2||a.rsv2,this.rsv3=this.rsv3||a.rsv3,null===this.opcode&&(this.opcode=a.opcode),this._chunks.push(a.payload),this.length+=a.length}};for(var g in f)e.prototype[g]=f[g];a.exports=e},62253:(a,b,c)=>{var d=c(79428),e=d.Buffer;function f(a,b){for(var c in a)b[c]=a[c]}function g(a,b,c){return e(a,b,c)}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?a.exports=d:(f(d,b),b.Buffer=g),g.prototype=Object.create(e.prototype),f(e,g),g.from=function(a,b,c){if("number"==typeof a)throw TypeError("Argument must not be a number");return e(a,b,c)},g.alloc=function(a,b,c){if("number"!=typeof a)throw TypeError("Argument must be a number");var d=e(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},g.allocUnsafe=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return e(a)},g.allocUnsafeSlow=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return d.SlowBuffer(a)}},62466:a=>{"use strict";var b=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,c=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,d=RegExp(b.source+"(?:=(?:"+b.source+"|"+/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/.source+"))?"),e=RegExp(b.source+"(?: *; *"+d.source+")*","g"),f=RegExp("^"+e.source+"(?: *, *"+e.source+")*$"),g=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,h=Object.prototype.hasOwnProperty,i=function(){this._byName={},this._inOrder=[]};i.prototype.push=function(a,b){h.call(this._byName,a)||(this._byName[a]=[]),this._byName[a].push(b),this._inOrder.push({name:a,params:b})},i.prototype.eachOffer=function(a,b){for(var c=this._inOrder,d=0,e=c.length;d<e;d++)a.call(b,c[d].name,c[d].params)},i.prototype.byName=function(a){return this._byName[a]||[]},i.prototype.toArray=function(){return this._inOrder.slice()},a.exports={parseHeader:function(a){var b=new i;if(""===a||void 0===a)return b;if(!f.test(a))throw SyntaxError("Invalid Sec-WebSocket-Extensions header: "+a);return a.match(e).forEach(function(a){var c=a.match(RegExp(d.source,"g")),e=c.shift(),f={};c.forEach(function(a){var b,c=a.match(d),e=c[1];b=void 0!==c[2]?c[2]:void 0===c[3]||c[3].replace(/\\/g,""),g.test(b)&&(b=parseFloat(b)),h.call(f,e)?(f[e]=[].concat(f[e]),f[e].push(b)):f[e]=b},this),b.push(e,f)},this),b},serializeParams:function(a,b){var d=[],e=function(a,b){b instanceof Array?b.forEach(function(b){e(a,b)}):!0===b?d.push(a):"number"==typeof b?d.push(a+"="+b):c.test(b)?d.push(a+'="'+b.replace(/"/g,'\\"')+'"'):d.push(a+"="+b)};for(var f in b)e(f,b[f]);return[a].concat(d).join("; ")}}},63416:(a,b,c)=>{"use strict";var d=c(27910).Stream,e=c(28354),f=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(f,d),f.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0},f.prototype.resume=function(){this._paused=!1,this.emit("drain");var a=this._driver.messages;a._paused=!1,a.emit("drain")},f.prototype.write=function(a){return!!this.writable&&(this._driver.parse(a),!this._paused)},f.prototype.end=function(a){if(this.writable){void 0!==a&&this.write(a),this.writable=!1;var b=this._driver.messages;b.readable&&(b.readable=b.writable=!1,b.emit("end"))}},f.prototype.destroy=function(){this.end()};var g=function(a){this.readable=this.writable=!0,this._paused=!1,this._driver=a};e.inherits(g,d),g.prototype.pause=function(){this._driver.io._paused=!0},g.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")},g.prototype.write=function(a){return!!this.writable&&("string"==typeof a?this._driver.text(a):this._driver.binary(a),!this._paused)},g.prototype.end=function(a){void 0!==a&&this.write(a)},g.prototype.destroy=function(){},b.IO=f,b.Messages=g},63995:(a,b,c)=>{"use strict";var d=c(28354),e=c(91645),f=c(34631),g=c(79551),h=c(94519),i=c(99826);c(50501);var j={"http:":80,"https:":443,"ws:":80,"wss:":443},k=["https:","wss:"],l=function(a,b,c){c=c||{},this.url=a,this._driver=h.client(this.url,{maxLength:c.maxLength,protocols:b}),["open","error"].forEach(function(a){this._driver.on(a,function(){s.headers=s._driver.headers,s.statusCode=s._driver.statusCode})},this);var d=c.proxy||{},l=g.parse(d.origin||this.url),m=l.port||j[l.protocol],n=k.indexOf(l.protocol)>=0,o=function(){s._onConnect()},p=c.net||{},q=c.tls||{},r=d.origin?d.tls||{}:q,s=this;p.host=r.host=l.hostname,p.port=r.port=m,q.ca=q.ca||c.ca,r.servername=r.servername||l.hostname,this._stream=n?f.connect(r,o):e.connect(p,o),d.origin&&this._configureProxy(d,q),i.call(this,c)};d.inherits(l,i),l.prototype._onConnect=function(){(this._proxy||this._driver).start()},l.prototype._configureProxy=function(a,b){var c,d=g.parse(this.url),e=k.indexOf(d.protocol)>=0,h=this;if(this._proxy=this._driver.proxy(a.origin),a.headers)for(c in a.headers)this._proxy.setHeader(c,a.headers[c]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(e){var a={socket:h._stream,servername:d.hostname};for(c in b)a[c]=b[c];h._stream=f.connect(a),h._configureStream()}h._driver.io.pipe(h._stream),h._stream.pipe(h._driver.io),h._driver.start()}),this._proxy.on("error",function(a){h._driver.emit("error",a)})},a.exports=l},66186:a=>{"use strict";var b=function(){},c={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(var d in c)b.prototype[d]=c[d];a.exports=b},69727:(a,b,c)=>{"use strict";var d=c(4717),e=function(a,b){this._session=a,this._method=b,this._queue=new d(e.QUEUE_SIZE),this._stopped=!1,this.pending=0};e.QUEUE_SIZE=8,e.prototype.call=function(a,b,c,d){if(!this._stopped){var e={error:a,message:b,callback:c,context:d,done:!1},f=!1,g=this;if(this._queue.push(e),e.error)return e.done=!0,this._stop(),this._flushQueue();var h=function(a,b){f^(f=!0)&&(a?(g._stop(),e.error=a,e.message=null):e.message=b,e.done=!0,g._flushQueue())};try{this._session[this._method](b,h)}catch(a){h(a)}}},e.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0},e.prototype._flushQueue=function(){for(var a,b=this._queue;b.length>0&&b.peek().done;)(a=b.shift()).error?(this.pending=0,b.clear()):this.pending-=1,a.callback.call(a.context,a.error,a.message)},a.exports=e},72153:(a,b,c)=>{"use strict";var d=c(28354),e=c(31531),f=c(28647),g=c(93867),h=c(6094),i=c(31820),j=function(a){f.call(this,null,null,a),this._http=new e("request")};d.inherits(j,f);var k={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(a){if(this._delegate)return this._delegate.parse(a);if(this._http.parse(a),this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var b=this;this._delegate=j.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(a){this._delegate.on(a,function(c){b.emit(a,c)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new f.ConnectEvent)}},_open:function(){this.__queue.forEach(function(a){this._delegate[a[0]].apply(this._delegate,a[1])},this),this.__queue=[]}};for(var l in["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(a){k[a]=function(){return this._delegate?this._delegate[a].apply(this._delegate,arguments):(this.__queue.push([a,arguments]),!0)}}),k)j.prototype[l]=k[l];j.isSecureRequest=function(a){if(a.connection&&void 0!==a.connection.authorized||a.socket&&a.socket.secure)return!0;var b=a.headers;return!!b&&("on"===b.https||"on"===b["x-forwarded-ssl"]||"https"===b["x-forwarded-scheme"]||"https"===b["x-forwarded-proto"])},j.determineUrl=function(a){return(this.isSecureRequest(a)?"wss:":"ws:")+"//"+a.headers.host+a.url},j.http=function(a,b){void 0===(b=b||{}).requireMasking&&(b.requireMasking=!0);var c=a.headers,d=c["sec-websocket-version"],e=c["sec-websocket-key"],f=c["sec-websocket-key1"],j=c["sec-websocket-key2"],k=this.determineUrl(a);return d||e?new i(a,k,b):f||j?new h(a,k,b):new g(a,k,b)},a.exports=j},77018:(a,b,c)=>{"use strict";var d=c(62253).Buffer,e=function(){this._queue=[],this._queueSize=0,this._offset=0};e.prototype.put=function(a){a&&0!==a.length&&(d.isBuffer(a)||(a=d.from(a)),this._queue.push(a),this._queueSize+=a.length)},e.prototype.read=function(a){if(a>this._queueSize)return null;if(0===a)return d.alloc(0);this._queueSize-=a;var b,c,e=this._queue,f=a,g=e[0];if(g.length>=a)if(g.length===a)return e.shift();else return c=g.slice(0,a),e[0]=g.slice(a),c;for(var h=0,i=e.length;h<i&&!(f<e[h].length);h++)f-=e[h].length;return b=e.splice(0,h),f>0&&e.length>0&&(b.push(e[0].slice(0,f)),e[0]=e[0].slice(f)),d.concat(b,a)},e.prototype.eachByte=function(a,b){for(var c,d,e;this._queue.length>0;){for(d=(c=this._queue[0]).length;this._offset<d;)e=this._offset,this._offset+=1,a.call(b,c[e]);this._offset=0,this._queue.shift()}},a.exports=e},77211:(a,b,c)=>{"use strict";let d,e,f,g,h,i,j,k,l,m;c.d(b,{C3:()=>dN,Zy:()=>dK,VC:()=>dE,KR:()=>dC,TF:()=>dF,hZ:()=>dG,yo:()=>dH});var n,o=c(9757),p=c(28375),q=c(85049),r=c(14186),s=c(27894);let t=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,u="websocket",v="long_polling";class w{constructor(a){this.domStorage_=a,this.prefix_="firebase:"}set(a,b){null==b?this.domStorage_.removeItem(this.prefixedName_(a)):this.domStorage_.setItem(this.prefixedName_(a),(0,p.As)(b))}get(a){let b=this.domStorage_.getItem(this.prefixedName_(a));return null==b?null:(0,p.$L)(b)}remove(a){this.domStorage_.removeItem(this.prefixedName_(a))}prefixedName_(a){return this.prefix_+a}toString(){return this.domStorage_.toString()}}class x{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(a,b){null==b?delete this.cache_[a]:this.cache_[a]=b}get(a){return(0,p.gR)(this.cache_,a)?this.cache_[a]:null}remove(a){delete this.cache_[a]}}let y=function(a){try{if("undefined"!=typeof window&&void 0!==window[a]){let b=window[a];return b.setItem("firebase:sentinel","cache"),b.removeItem("firebase:sentinel"),new w(b)}}catch(a){}return new x},z=y("localStorage"),A=y("sessionStorage"),B=new q.Vy("@firebase/database"),C=function(){let a=1;return function(){return a++}}(),D=function(a){let b=(0,p.kj)(a),c=new p.gz;c.update(b);let d=c.digest();return p.K3.encodeByteArray(d)},E=function(...a){let b="";for(let c=0;c<a.length;c++){let d=a[c];Array.isArray(d)||d&&"object"==typeof d&&"number"==typeof d.length?b+=E.apply(null,d):"object"==typeof d?b+=(0,p.As)(d):b+=d,b+=" "}return b},F=null,G=!0,H=function(a,b){(0,p.vA)(!b||!0===a||!1===a,"Can't turn on custom loggers persistently."),!0===a?(B.logLevel=q.$b.VERBOSE,F=B.log.bind(B),b&&A.set("logging_enabled",!0)):"function"==typeof a?F=a:(F=null,A.remove("logging_enabled"))},I=function(...a){if(!0===G&&(G=!1,null===F&&!0===A.get("logging_enabled")&&H(!0)),F){let b=E.apply(null,a);F(b)}},J=function(a){return function(...b){I(a,...b)}},K=function(...a){let b="FIREBASE INTERNAL ERROR: "+E(...a);B.error(b)},L=function(...a){let b=`FIREBASE FATAL ERROR: ${E(...a)}`;throw B.error(b),Error(b)},M=function(...a){let b="FIREBASE WARNING: "+E(...a);B.warn(b)},N=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&M("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},O=function(a){return"number"==typeof a&&(a!=a||a===1/0||a===-1/0)},P=function(a){if((0,p.$g)()||"complete"===document.readyState)a();else{let b=!1,c=function(){if(!document.body)return void setTimeout(c,Math.floor(10));b||(b=!0,a())};document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&c()}),window.attachEvent("onload",c))}},Q="[MIN_NAME]",R="[MAX_NAME]",S=function(a,b){if(a===b)return 0;{if(a===Q||b===R)return -1;if(b===Q||a===R)return 1;let c=$(a),d=$(b);if(null!==c)if(null!==d)return c-d==0?a.length-b.length:c-d;else return -1;return null!==d?1:a<b?-1:1}},T=function(a,b){return a===b?0:a<b?-1:1},U=function(a,b){if(b&&a in b)return b[a];throw Error("Missing required key ("+a+") in object: "+(0,p.As)(b))},V=function(a){if("object"!=typeof a||null===a)return(0,p.As)(a);let b=[];for(let c in a)b.push(c);b.sort();let c="{";for(let d=0;d<b.length;d++)0!==d&&(c+=","),c+=(0,p.As)(b[d]),c+=":",c+=V(a[b[d]]);return c+"}"},W=function(a,b){let c=a.length;if(c<=b)return[a];let d=[];for(let e=0;e<c;e+=b)e+b>c?d.push(a.substring(e,c)):d.push(a.substring(e,e+b));return d};function X(a,b){for(let c in a)a.hasOwnProperty(c)&&b(c,a[c])}let Y=function(a){let b,c,d,e,f;(0,p.vA)(!O(a),"Invalid JSON number");0===a?(c=0,d=0,b=+(1/a==-1/0)):(b=a<0,(a=Math.abs(a))>=22250738585072014e-324?(c=(e=Math.min(Math.floor(Math.log(a)/Math.LN2),1023))+1023,d=Math.round(a*Math.pow(2,52-e)-0x10000000000000)):(c=0,d=Math.round(a/5e-324)));let g=[];for(f=52;f;f-=1)g.push(d%2?1:0),d=Math.floor(d/2);for(f=11;f;f-=1)g.push(c%2?1:0),c=Math.floor(c/2);g.push(+!!b),g.reverse();let h=g.join(""),i="";for(f=0;f<64;f+=8){let a=parseInt(h.substr(f,8),2).toString(16);1===a.length&&(a="0"+a),i+=a}return i.toLowerCase()},Z=RegExp("^-?(0*)\\d{1,10}$"),$=function(a){if(Z.test(a)){let b=Number(a);if(b>=-0x80000000&&b<=0x7fffffff)return b}return null},_=function(a){try{a()}catch(a){setTimeout(()=>{throw M("Exception was thrown by user callback.",a.stack||""),a},Math.floor(0))}},aa=function(a,b){let c=setTimeout(a,b);return"number"==typeof c&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(c):"object"==typeof c&&c.unref&&c.unref(),c};class ab{constructor(a,b,c,d,e=!1,f="",g=!1,h=!1,i=null){this.secure=b,this.namespace=c,this.webSocketOnly=d,this.nodeAdmin=e,this.persistenceKey=f,this.includeNamespaceInQueryParams=g,this.isUsingEmulator=h,this.emulatorOptions=i,this._host=a.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=z.get("host:"+a)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(a){a!==this.internalHost&&(this.internalHost=a,this.isCacheableHost()&&z.set("host:"+this._host,this.internalHost))}toString(){let a=this.toURLString();return this.persistenceKey&&(a+="<"+this.persistenceKey+">"),a}toURLString(){let a=this.secure?"https://":"http://",b=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${a}${this.host}/${b}`}}function ac(a,b,c){let d;if((0,p.vA)("string"==typeof b,"typeof type must == string"),(0,p.vA)("object"==typeof c,"typeof params must == object"),b===u)d=(a.secure?"wss://":"ws://")+a.internalHost+"/.ws?";else if(b===v)d=(a.secure?"https://":"http://")+a.internalHost+"/.lp?";else throw Error("Unknown connection type: "+b);(a.host!==a.internalHost||a.isCustomHost()||a.includeNamespaceInQueryParams)&&(c.ns=a.namespace);let e=[];return X(c,(a,b)=>{e.push(a+"="+b)}),d+e.join("&")}class ad{constructor(){this.counters_={}}incrementCounter(a,b=1){(0,p.gR)(this.counters_,a)||(this.counters_[a]=0),this.counters_[a]+=b}get(){return(0,p.A4)(this.counters_)}}let ae={},af={};function ag(a){let b=a.toString();return ae[b]||(ae[b]=new ad),ae[b]}let ah="",ai=null;"undefined"!=typeof MozWebSocket?ai=MozWebSocket:"undefined"!=typeof WebSocket&&(ai=WebSocket);class aj{constructor(a,b,c,d,e,f,g){this.connId=a,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=J(this.connId),this.stats_=ag(b),this.connURL=aj.connectionURL_(b,f,g,d,c),this.nodeAdmin=b.nodeAdmin}static connectionURL_(a,b,c,d,e){let f={};return f.v="5",!(0,p.$g)()&&"undefined"!=typeof location&&location.hostname&&t.test(location.hostname)&&(f.r="f"),b&&(f.s=b),c&&(f.ls=c),d&&(f.ac=d),e&&(f.p=e),ac(a,u,f)}open(a,b){this.onDisconnect=b,this.onMessage=a,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,z.set("previous_websocket_failure",!0);try{let a;if((0,p.$g)()){let b=this.nodeAdmin?"AdminNode":"Node";a={headers:{"User-Agent":`Firebase/5/${ah}/${process.platform}/${b}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(a.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(a.headers["X-Firebase-AppCheck"]=this.appCheckToken);let c=process.env,d=0===this.connURL.indexOf("wss://")?c.HTTPS_PROXY||c.https_proxy:c.HTTP_PROXY||c.http_proxy;d&&(a.proxy={origin:d})}this.mySock=new ai(this.connURL,[],a)}catch(b){this.log_("Error instantiating WebSocket.");let a=b.message||b.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");let b=a.message||a.data;b&&this.log_(b),this.onClosed_()}}start(){}static forceDisallow(){aj.forceDisallow_=!0}static isAvailable(){let a=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let b=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);b&&b.length>1&&4.4>parseFloat(b[1])&&(a=!0)}return!a&&null!==ai&&!aj.forceDisallow_}static previouslyFailed(){return z.isInMemoryStorage||!0===z.get("previous_websocket_failure")}markConnectionHealthy(){z.remove("previous_websocket_failure")}appendFrame_(a){if(this.frames.push(a),this.frames.length===this.totalFrames){let a=this.frames.join("");this.frames=null;let b=(0,p.$L)(a);this.onMessage(b)}}handleNewFrameCount_(a){this.totalFrames=a,this.frames=[]}extractFrameCount_(a){if((0,p.vA)(null===this.frames,"We already have a frame buffer"),a.length<=6){let b=Number(a);if(!isNaN(b))return this.handleNewFrameCount_(b),null}return this.handleNewFrameCount_(1),a}handleIncomingFrame(a){if(null===this.mySock)return;let b=a.data;if(this.bytesReceived+=b.length,this.stats_.incrementCounter("bytes_received",b.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(b);else{let a=this.extractFrameCount_(b);null!==a&&this.appendFrame_(a)}}send(a){this.resetKeepAlive();let b=(0,p.As)(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=W(b,16384);c.length>1&&this.sendString_(String(c.length));for(let a=0;a<c.length;a++)this.sendString_(c[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(a){try{this.mySock.send(a)}catch(a){this.log_("Exception thrown from WebSocket.send():",a.message||a.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}aj.responsesRequiredToBeHealthy=2,aj.healthyTimeout=3e4;let ak="@firebase/database",al="1.0.20";class am{constructor(a,b){this.appCheckProvider=b,this.appName=a.name,(0,r.xZ)(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken),this.appCheck=null==b?void 0:b.getImmediate({optional:!0}),this.appCheck||null==b||b.get().then(a=>this.appCheck=a)}getToken(a){if(this.serverAppAppCheckToken){if(a)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(a):new Promise((b,c)=>{setTimeout(()=>{this.appCheck?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){var b;null==(b=this.appCheckProvider)||b.get().then(b=>b.addTokenListener(a))}notifyForInvalidToken(){M(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class an{constructor(a,b,c){this.appName_=a,this.firebaseOptions_=b,this.authProvider_=c,this.auth_=null,this.auth_=c.getImmediate({optional:!0}),this.auth_||c.onInit(a=>this.auth_=a)}getToken(a){return this.auth_?this.auth_.getToken(a).catch(a=>a&&"auth/token-not-initialized"===a.code?(I("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(a)):new Promise((b,c)=>{setTimeout(()=>{this.auth_?this.getToken(a).then(b,c):b(null)},0)})}addTokenChangeListener(a){this.auth_?this.auth_.addAuthTokenListener(a):this.authProvider_.get().then(b=>b.addAuthTokenListener(a))}removeTokenChangeListener(a){this.authProvider_.get().then(b=>b.removeAuthTokenListener(a))}notifyForInvalidToken(){let a='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?a+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?a+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':a+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',M(a)}}class ao{constructor(a){this.accessToken=a}getToken(a){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(a){a(this.accessToken)}removeTokenChangeListener(a){}notifyForInvalidToken(){}}ao.OWNER="owner";class ap{constructor(a){this.onMessage_=a,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(a,b){this.closeAfterResponse=a,this.onClose=b,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(a,b){for(this.pendingResponses[a]=b;this.pendingResponses[this.currentResponseNum];){let a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let b=0;b<a.length;++b)a[b]&&_(()=>{this.onMessage_(a[b])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let aq="start";class ar{constructor(a,b,c,d,e,f,g){this.connId=a,this.repoInfo=b,this.applicationId=c,this.appCheckToken=d,this.authToken=e,this.transportSessionId=f,this.lastSessionId=g,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=J(a),this.stats_=ag(b),this.urlFn=a=>(this.appCheckToken&&(a.ac=this.appCheckToken),ac(b,v,a))}open(a,b){this.curSegmentNum=0,this.onDisconnect_=b,this.myPacketOrderer=new ap(a),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),P(()=>{if(this.isClosed_)return;this.scriptTagHolder=new as((...a)=>{let[b,c,d,e,f]=a;if(this.incrementIncomingBytes_(a),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,b===aq)this.id=c,this.password=d;else if("close"===b)c?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(c,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+b)},(...a)=>{let[b,c]=a;this.incrementIncomingBytes_(a),this.myPacketOrderer.handleResponse(b,c)},()=>{this.onClosed_()},this.urlFn);let a={};a[aq]="t",a.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(a.cb=this.scriptTagHolder.uniqueCallbackIdentifier),a.v="5",this.transportSessionId&&(a.s=this.transportSessionId),this.lastSessionId&&(a.ls=this.lastSessionId),this.applicationId&&(a.p=this.applicationId),this.appCheckToken&&(a.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&t.test(location.hostname)&&(a.r="f");let b=this.urlFn(a);this.log_("Connecting via long-poll to "+b),this.scriptTagHolder.addTag(b,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ar.forceAllow_=!0}static forceDisallow(){ar.forceDisallow_=!0}static isAvailable(){return!(0,p.$g)()&&(!!ar.forceAllow_||!ar.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(a){let b=(0,p.As)(a);this.bytesSent+=b.length,this.stats_.incrementCounter("bytes_sent",b.length);let c=W((0,p.KA)(b),1840);for(let a=0;a<c.length;a++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[a]),this.curSegmentNum++}addDisconnectPingFrame(a,b){if((0,p.$g)())return;this.myDisconnFrame=document.createElement("iframe");let c={};c.dframe="t",c.id=a,c.pw=b,this.myDisconnFrame.src=this.urlFn(c),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(a){let b=(0,p.As)(a).length;this.bytesReceived+=b,this.stats_.incrementCounter("bytes_received",b)}}class as{constructor(a,b,c,d){if(this.onDisconnect=c,this.urlFn=d,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,p.$g)())this.commandCB=a,this.onMessageCB=b;else{this.uniqueCallbackIdentifier=C(),window["pLPCommand"+this.uniqueCallbackIdentifier]=a,window["pRTLPCB"+this.uniqueCallbackIdentifier]=b,this.myIFrame=as.createIFrame_();let c="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(c='<script>document.domain="'+document.domain+'";<\/script>');let d="<html><body>"+c+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(d),this.myIFrame.doc.close()}catch(a){I("frame writing exception"),a.stack&&I(a.stack),I(a)}}}static createIFrame_(){let a=document.createElement("iframe");if(a.style.display="none",document.body){document.body.appendChild(a);try{a.contentWindow.document||I("No IE domain setting required")}catch(b){a.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return a.contentDocument?a.doc=a.contentDocument:a.contentWindow?a.doc=a.contentWindow.document:a.document&&(a.doc=a.document),a}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let a=this.onDisconnect;a&&(this.onDisconnect=null,a())}startLongPoll(a,b){for(this.myID=a,this.myPW=b,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let a={};a.id=this.myID,a.pw=this.myPW,a.ser=this.currentSerial;let b=this.urlFn(a),c="",d=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+c.length<=1870){let a=this.pendingSegs.shift();c=c+"&seg"+d+"="+a.seg+"&ts"+d+"="+a.ts+"&d"+d+"="+a.d,d++}else break;return b+=c,this.addLongPollTag_(b,this.currentSerial),!0}}enqueueSegment(a,b,c){this.pendingSegs.push({seg:a,ts:b,d:c}),this.alive&&this.newRequest_()}addLongPollTag_(a,b){this.outstandingRequests.add(b);let c=()=>{this.outstandingRequests.delete(b),this.newRequest_()},d=setTimeout(c,Math.floor(25e3));this.addTag(a,()=>{clearTimeout(d),c()})}addTag(a,b){(0,p.$g)()?this.doNodeLongPoll(a,b):setTimeout(()=>{try{if(!this.sendNewPolls)return;let c=this.myIFrame.doc.createElement("script");c.type="text/javascript",c.async=!0,c.src=a,c.onload=c.onreadystatechange=function(){let a=c.readyState;a&&"loaded"!==a&&"complete"!==a||(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),b())},c.onerror=()=>{I("Long-poll script failed to load: "+a),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(c)}catch(a){}},Math.floor(1))}}class at{static get ALL_TRANSPORTS(){return[ar,aj]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(a){this.initTransports_(a)}initTransports_(a){let b=aj&&aj.isAvailable(),c=b&&!aj.previouslyFailed();if(a.webSocketOnly&&(b||M("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[aj];else{let a=this.transports_=[];for(let b of at.ALL_TRANSPORTS)b&&b.isAvailable()&&a.push(b);at.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}at.globalTransportInitialized_=!1;class au{constructor(a,b,c,d,e,f,g,h,i,j){this.id=a,this.repoInfo_=b,this.applicationId_=c,this.appCheckToken_=d,this.authToken_=e,this.onMessage_=f,this.onReady_=g,this.onDisconnect_=h,this.onKill_=i,this.lastSessionId=j,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=J("c:"+this.id+":"),this.transportManager_=new at(b),this.log_("Connection created"),this.start_()}start_(){let a=this.transportManager_.initialTransport();this.conn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.conn_),c=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(b,c)},Math.floor(0));let d=a.healthyTimeout||0;d>0&&(this.healthyTimeout_=aa(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(d)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(a){return b=>{a===this.conn_?this.onConnectionLost_(b):a===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(a){return b=>{2!==this.state_&&(a===this.rx_?this.onPrimaryMessageReceived_(b):a===this.secondaryConn_?this.onSecondaryMessageReceived_(b):this.log_("message on old connection"))}}sendRequest(a){this.sendData_({t:"d",d:a})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(a){if("t"in a){let b=a.t;"a"===b?this.upgradeIfSecondaryHealthy_():"r"===b?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===b&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(a){let b=U("t",a),c=U("d",a);if("c"===b)this.onSecondaryControl_(c);else if("d"===b)this.pendingDataMessages.push(c);else throw Error("Unknown protocol layer: "+b)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(a){let b=U("t",a),c=U("d",a);"c"===b?this.onControl_(c):"d"===b&&this.onDataMessage_(c)}onDataMessage_(a){this.onPrimaryResponse_(),this.onMessage_(a)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(a){let b=U("t",a);if("d"in a){let c=a.d;if("h"===b){let a=Object.assign({},c);this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if("n"===b){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===b?this.onConnectionShutdown_(c):"r"===b?this.onReset_(c):"e"===b?K("Server Error: "+c):"o"===b?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):K("Unknown control packet command: "+b)}}onHandshake_(a){let b=a.ts,c=a.v,d=a.h;this.sessionId=a.s,this.repoInfo_.host=d,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,b),"5"!==c&&M("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let a=this.transportManager_.upgradeTransport();a&&this.startUpgrade_(a)}startUpgrade_(a){this.secondaryConn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;let b=this.connReceiver_(this.secondaryConn_),c=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(b,c),aa(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(a){this.log_("Reset packet received.  New host: "+a),this.repoInfo_.host=a,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(a,b){this.log_("Realtime connection established."),this.conn_=a,this.state_=1,this.onReady_&&(this.onReady_(b,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):aa(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let a=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===a||this.rx_===a)&&this.close()}onConnectionLost_(a){this.conn_=null,a||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(z.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(a){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(a),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(a){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(a)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class av{put(a,b,c,d){}merge(a,b,c,d){}refreshAuthToken(a){}refreshAppCheckToken(a){}onDisconnectPut(a,b,c){}onDisconnectMerge(a,b,c){}onDisconnectCancel(a,b){}reportStats(a){}}class aw{constructor(a){this.allowedEvents_=a,this.listeners_={},(0,p.vA)(Array.isArray(a)&&a.length>0,"Requires a non-empty array")}trigger(a,...b){if(Array.isArray(this.listeners_[a])){let c=[...this.listeners_[a]];for(let a=0;a<c.length;a++)c[a].callback.apply(c[a].context,b)}}on(a,b,c){this.validateEventType_(a),this.listeners_[a]=this.listeners_[a]||[],this.listeners_[a].push({callback:b,context:c});let d=this.getInitialEvent(a);d&&b.apply(c,d)}off(a,b,c){this.validateEventType_(a);let d=this.listeners_[a]||[];for(let a=0;a<d.length;a++)if(d[a].callback===b&&(!c||c===d[a].context))return void d.splice(a,1)}validateEventType_(a){(0,p.vA)(this.allowedEvents_.find(b=>b===a),"Unknown event: "+a)}}class ax extends aw{static getInstance(){return new ax}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,p.jZ)()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(a){return(0,p.vA)("online"===a,"Unknown event type: "+a),[this.online_]}currentlyOnline(){return this.online_}}class ay{constructor(a,b){if(void 0===b){this.pieces_=a.split("/");let b=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[b]=this.pieces_[a],b++);this.pieces_.length=b,this.pieceNum_=0}else this.pieces_=a,this.pieceNum_=b}toString(){let a="";for(let b=this.pieceNum_;b<this.pieces_.length;b++)""!==this.pieces_[b]&&(a+="/"+this.pieces_[b]);return a||"/"}}function az(){return new ay("")}function aA(a){return a.pieceNum_>=a.pieces_.length?null:a.pieces_[a.pieceNum_]}function aB(a){return a.pieces_.length-a.pieceNum_}function aC(a){let b=a.pieceNum_;return b<a.pieces_.length&&b++,new ay(a.pieces_,b)}function aD(a){return a.pieceNum_<a.pieces_.length?a.pieces_[a.pieces_.length-1]:null}function aE(a,b=0){return a.pieces_.slice(a.pieceNum_+b)}function aF(a){if(a.pieceNum_>=a.pieces_.length)return null;let b=[];for(let c=a.pieceNum_;c<a.pieces_.length-1;c++)b.push(a.pieces_[c]);return new ay(b,0)}function aG(a,b){let c=[];for(let b=a.pieceNum_;b<a.pieces_.length;b++)c.push(a.pieces_[b]);if(b instanceof ay)for(let a=b.pieceNum_;a<b.pieces_.length;a++)c.push(b.pieces_[a]);else{let a=b.split("/");for(let b=0;b<a.length;b++)a[b].length>0&&c.push(a[b])}return new ay(c,0)}function aH(a){return a.pieceNum_>=a.pieces_.length}function aI(a,b){let c=aA(a),d=aA(b);if(null===c)return b;if(c===d)return aI(aC(a),aC(b));throw Error("INTERNAL ERROR: innerPath ("+b+") is not within outerPath ("+a+")")}function aJ(a,b){let c=aE(a,0),d=aE(b,0);for(let a=0;a<c.length&&a<d.length;a++){let b=S(c[a],d[a]);if(0!==b)return b}return c.length===d.length?0:c.length<d.length?-1:1}function aK(a,b){if(aB(a)!==aB(b))return!1;for(let c=a.pieceNum_,d=b.pieceNum_;c<=a.pieces_.length;c++,d++)if(a.pieces_[c]!==b.pieces_[d])return!1;return!0}function aL(a,b){let c=a.pieceNum_,d=b.pieceNum_;if(aB(a)>aB(b))return!1;for(;c<a.pieces_.length;){if(a.pieces_[c]!==b.pieces_[d])return!1;++c,++d}return!0}class aM{constructor(a,b){this.errorPrefix_=b,this.parts_=aE(a,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=(0,p.OE)(this.parts_[a]);aN(this)}}function aN(a){if(a.byteLength_>768)throw Error(a.errorPrefix_+"has a key path longer than 768 bytes ("+a.byteLength_+").");if(a.parts_.length>32)throw Error(a.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+aO(a))}function aO(a){return 0===a.parts_.length?"":"in property '"+a.parts_.join(".")+"'"}class aP extends aw{static getInstance(){return new aP}constructor(){let a,b;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(b="visibilitychange",a="hidden"):void 0!==document.mozHidden?(b="mozvisibilitychange",a="mozHidden"):void 0!==document.msHidden?(b="msvisibilitychange",a="msHidden"):void 0!==document.webkitHidden&&(b="webkitvisibilitychange",a="webkitHidden")),this.visible_=!0,b&&document.addEventListener(b,()=>{let b=!document[a];b!==this.visible_&&(this.visible_=b,this.trigger("visible",b))},!1)}getInitialEvent(a){return(0,p.vA)("visible"===a,"Unknown event type: "+a),[this.visible_]}}class aQ extends av{constructor(a,b,c,d,e,f,g,h){if(super(),this.repoInfo_=a,this.applicationId_=b,this.onDataUpdate_=c,this.onConnectStatus_=d,this.onServerInfoUpdate_=e,this.authTokenProvider_=f,this.appCheckTokenProvider_=g,this.authOverride_=h,this.id=aQ.nextPersistentConnectionId_++,this.log_=J("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,h&&!(0,p.$g)())throw Error("Auth override specified in options, but not supported on non Node.js platforms");aP.getInstance().on("visible",this.onVisible_,this),-1===a.host.indexOf("fblocal")&&ax.getInstance().on("online",this.onOnline_,this)}sendRequest(a,b,c){let d=++this.requestNumber_,e={r:d,a:a,b:b};this.log_((0,p.As)(e)),(0,p.vA)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(e),c&&(this.requestCBHash_[d]=c)}get(a){this.initConnection_();let b=new p.cY,c={p:a._path.toString(),q:a._queryObject};this.outstandingGets_.push({action:"g",request:c,onComplete:a=>{let c=a.d;"ok"===a.s?b.resolve(c):b.reject(c)}}),this.outstandingGetCount_++;let d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),b.promise}listen(a,b,c,d){this.initConnection_();let e=a._queryIdentifier,f=a._path.toString();this.log_("Listen called for "+f+" "+e),this.listens.has(f)||this.listens.set(f,new Map),(0,p.vA)(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,p.vA)(!this.listens.get(f).has(e),"listen() called twice for same path/queryId.");let g={onComplete:d,hashFn:b,query:a,tag:c};this.listens.get(f).set(e,g),this.connected_&&this.sendListen_(g)}sendGet_(a){let b=this.outstandingGets_[a];this.sendRequest("g",b.request,c=>{delete this.outstandingGets_[a],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),b.onComplete&&b.onComplete(c)})}sendListen_(a){let b=a.query,c=b._path.toString(),d=b._queryIdentifier;this.log_("Listen on "+c+" for "+d);let e={p:c};a.tag&&(e.q=b._queryObject,e.t=a.tag),e.h=a.hashFn(),this.sendRequest("q",e,e=>{let f=e.d,g=e.s;aQ.warnOnListenWarnings_(f,b),(this.listens.get(c)&&this.listens.get(c).get(d))===a&&(this.log_("listen response",e),"ok"!==g&&this.removeListen_(c,d),a.onComplete&&a.onComplete(g,f))})}static warnOnListenWarnings_(a,b){if(a&&"object"==typeof a&&(0,p.gR)(a,"w")){let c=(0,p.yw)(a,"w");if(Array.isArray(c)&&~c.indexOf("no_index")){let a='".indexOn": "'+b._queryParams.getIndex().toString()+'"',c=b._path.toString();M(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${c} to your security rules for better performance.`)}}}refreshAuthToken(a){this.authToken_=a,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(a)}reduceReconnectDelayIfAdminCredential_(a){(a&&40===a.length||(0,p.qc)(a))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(a){this.appCheckToken_=a,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let a=this.authToken_,b=(0,p.Cv)(a)?"auth":"gauth",c={cred:a};null===this.authOverride_?c.noauth=!0:"object"==typeof this.authOverride_&&(c.authvar=this.authOverride_),this.sendRequest(b,c,b=>{let c=b.s,d=b.d||"error";this.authToken_===a&&("ok"===c?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(c,d))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},a=>{let b=a.s,c=a.d||"error";"ok"===b?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(b,c)})}unlisten(a,b){let c=a._path.toString(),d=a._queryIdentifier;this.log_("Unlisten called for "+c+" "+d),(0,p.vA)(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(c,d)&&this.connected_&&this.sendUnlisten_(c,d,a._queryObject,b)}sendUnlisten_(a,b,c,d){this.log_("Unlisten on "+a+" for "+b);let e={p:a};d&&(e.q=c,e.t=d),this.sendRequest("n",e)}onDisconnectPut(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"o",data:b,onComplete:c})}onDisconnectMerge(a,b,c){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",a,b,c):this.onDisconnectRequestQueue_.push({pathString:a,action:"om",data:b,onComplete:c})}onDisconnectCancel(a,b){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",a,null,b):this.onDisconnectRequestQueue_.push({pathString:a,action:"oc",data:null,onComplete:b})}sendOnDisconnect_(a,b,c,d){let e={p:b,d:c};this.log_("onDisconnect "+a,e),this.sendRequest(a,e,a=>{d&&setTimeout(()=>{d(a.s,a.d)},Math.floor(0))})}put(a,b,c,d){this.putInternal("p",a,b,c,d)}merge(a,b,c,d){this.putInternal("m",a,b,c,d)}putInternal(a,b,c,d,e){this.initConnection_();let f={p:b,d:c};void 0!==e&&(f.h=e),this.outstandingPuts_.push({action:a,request:f,onComplete:d}),this.outstandingPutCount_++;let g=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(g):this.log_("Buffering put: "+b)}sendPut_(a){let b=this.outstandingPuts_[a].action,c=this.outstandingPuts_[a].request,d=this.outstandingPuts_[a].onComplete;this.outstandingPuts_[a].queued=this.connected_,this.sendRequest(b,c,c=>{this.log_(b+" response",c),delete this.outstandingPuts_[a],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),d&&d(c.s,c.d)})}reportStats(a){if(this.connected_){let b={c:a};this.log_("reportStats",b),this.sendRequest("s",b,a=>{if("ok"!==a.s){let b=a.d;this.log_("reportStats","Error sending stats: "+b)}})}}onDataMessage_(a){if("r"in a){this.log_("from server: "+(0,p.As)(a));let b=a.r,c=this.requestCBHash_[b];c&&(delete this.requestCBHash_[b],c(a.b))}else if("error"in a)throw"A server-side error has occurred: "+a.error;else"a"in a&&this.onDataPush_(a.a,a.b)}onDataPush_(a,b){this.log_("handleServerMessage",a,b),"d"===a?this.onDataUpdate_(b.p,b.d,!1,b.t):"m"===a?this.onDataUpdate_(b.p,b.d,!0,b.t):"c"===a?this.onListenRevoked_(b.p,b.q):"ac"===a?this.onAuthRevoked_(b.s,b.d):"apc"===a?this.onAppCheckRevoked_(b.s,b.d):"sd"===a?this.onSecurityDebugPacket_(b):K("Unrecognized action received from server: "+(0,p.As)(a)+"\nAre you using the latest client?")}onReady_(a,b){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(a),this.lastSessionId=b,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(a){(0,p.vA)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(a))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(a){a&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=a}onOnline_(a){a?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let a=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),b=Math.max(0,this.reconnectDelay_-a);b=Math.random()*b,this.log_("Trying to reconnect in "+b+"ms"),this.scheduleConnect_(b),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let a=this.onDataMessage_.bind(this),b=this.onReady_.bind(this),c=this.onRealtimeDisconnect_.bind(this),d=this.id+":"+aQ.nextConnectionId_++,e=this.lastSessionId,f=!1,g=null,h=function(){g?g.close():(f=!0,c())};this.realtime_={close:h,sendRequest:function(a){(0,p.vA)(g,"sendRequest call when we're not connected not allowed."),g.sendRequest(a)}};let i=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,j]=await Promise.all([this.authTokenProvider_.getToken(i),this.appCheckTokenProvider_.getToken(i)]);f?I("getToken() completed but was canceled"):(I("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=j&&j.token,g=new au(d,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,a,b,c,a=>{M(a+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},e))}catch(a){this.log_("Failed to get token: "+a),f||(this.repoInfo_.nodeAdmin&&M(a),h())}}}interrupt(a){I("Interrupting connection for reason: "+a),this.interruptReasons_[a]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(a){I("Resuming connection for reason: "+a),delete this.interruptReasons_[a],(0,p.Im)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(a){let b=a-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:b})}cancelSentTransactions_(){for(let a=0;a<this.outstandingPuts_.length;a++){let b=this.outstandingPuts_[a];b&&"h"in b.request&&b.queued&&(b.onComplete&&b.onComplete("disconnect"),delete this.outstandingPuts_[a],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(a,b){let c;c=b?b.map(a=>V(a)).join("$"):"default";let d=this.removeListen_(a,c);d&&d.onComplete&&d.onComplete("permission_denied")}removeListen_(a,b){let c,d=new ay(a).toString();if(this.listens.has(d)){let a=this.listens.get(d);c=a.get(b),a.delete(b),0===a.size&&this.listens.delete(d)}else c=void 0;return c}onAuthRevoked_(a,b){I("Auth token revoked: "+a+"/"+b),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===a||"permission_denied"===a)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(a,b){I("App check token revoked: "+a+"/"+b),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===a||"permission_denied"===a)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(a){this.securityDebugCallback_?this.securityDebugCallback_(a):"msg"in a&&console.log("FIREBASE: "+a.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let a of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let b of a.values())this.sendListen_(b);for(let a=0;a<this.outstandingPuts_.length;a++)this.outstandingPuts_[a]&&this.sendPut_(a);for(;this.onDisconnectRequestQueue_.length;){let a=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(a.action,a.pathString,a.data,a.onComplete)}for(let a=0;a<this.outstandingGets_.length;a++)this.outstandingGets_[a]&&this.sendGet_(a)}sendConnectStats_(){let a={},b="js";(0,p.$g)()&&(b=this.repoInfo_.nodeAdmin?"admin_node":"node"),a["sdk."+b+"."+ah.replace(/\./g,"-")]=1,(0,p.jZ)()?a["framework.cordova"]=1:(0,p.lV)()&&(a["framework.reactnative"]=1),this.reportStats(a)}shouldReconnect_(){let a=ax.getInstance().currentlyOnline();return(0,p.Im)(this.interruptReasons_)&&a}}aQ.nextPersistentConnectionId_=0,aQ.nextConnectionId_=0;class aR{constructor(a,b){this.name=a,this.node=b}static Wrap(a,b){return new aR(a,b)}}class aS{getCompare(){return this.compare.bind(this)}indexedValueChanged(a,b){let c=new aR(Q,a),d=new aR(Q,b);return 0!==this.compare(c,d)}minPost(){return aR.MIN}}class aT extends aS{static get __EMPTY_NODE(){return d}static set __EMPTY_NODE(a){d=a}compare(a,b){return S(a.name,b.name)}isDefinedOn(a){throw(0,p.Hk)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(a,b){return!1}minPost(){return aR.MIN}maxPost(){return new aR(R,d)}makePost(a,b){return(0,p.vA)("string"==typeof a,"KeyIndex indexValue must always be a string."),new aR(a,d)}toString(){return".key"}}let aU=new aT;class aV{constructor(a,b,c,d,e=null){this.isReverse_=d,this.resultGenerator_=e,this.nodeStack_=[];let f=1;for(;!a.isEmpty();)if(f=b?c(a.key,b):1,d&&(f*=-1),f<0)a=this.isReverse_?a.left:a.right;else if(0===f){this.nodeStack_.push(a);break}else this.nodeStack_.push(a),a=this.isReverse_?a.right:a.left}getNext(){let a;if(0===this.nodeStack_.length)return null;let b=this.nodeStack_.pop();if(a=this.resultGenerator_?this.resultGenerator_(b.key,b.value):{key:b.key,value:b.value},this.isReverse_)for(b=b.left;!b.isEmpty();)this.nodeStack_.push(b),b=b.right;else for(b=b.right;!b.isEmpty();)this.nodeStack_.push(b),b=b.left;return a}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let a=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(a.key,a.value):{key:a.key,value:a.value}}}class aW{constructor(a,b,c,d,e){this.key=a,this.value=b,this.color=null!=c?c:aW.RED,this.left=null!=d?d:aY.EMPTY_NODE,this.right=null!=e?e:aY.EMPTY_NODE}copy(a,b,c,d,e){return new aW(null!=a?a:this.key,null!=b?b:this.value,null!=c?c:this.color,null!=d?d:this.left,null!=e?e:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||!!a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,b,c){let d=this,e=c(a,d.key);return(d=e<0?d.copy(null,null,null,d.left.insert(a,b,c),null):0===e?d.copy(null,b,null,null,null):d.copy(null,null,null,null,d.right.insert(a,b,c))).fixUp_()}removeMin_(){if(this.left.isEmpty())return aY.EMPTY_NODE;let a=this;return a.left.isRed_()||a.left.left.isRed_()||(a=a.moveRedLeft_()),(a=a.copy(null,null,null,a.left.removeMin_(),null)).fixUp_()}remove(a,b){let c,d;if(c=this,0>b(a,c.key))c.left.isEmpty()||c.left.isRed_()||c.left.left.isRed_()||(c=c.moveRedLeft_()),c=c.copy(null,null,null,c.left.remove(a,b),null);else{if(c.left.isRed_()&&(c=c.rotateRight_()),c.right.isEmpty()||c.right.isRed_()||c.right.left.isRed_()||(c=c.moveRedRight_()),0===b(a,c.key))if(c.right.isEmpty())return aY.EMPTY_NODE;else d=c.right.min_(),c=c.copy(d.key,d.value,null,null,c.right.removeMin_());c=c.copy(null,null,null,null,c.right.remove(a,b))}return c.fixUp_()}isRed_(){return this.color}fixUp_(){let a=this;return a.right.isRed_()&&!a.left.isRed_()&&(a=a.rotateLeft_()),a.left.isRed_()&&a.left.left.isRed_()&&(a=a.rotateRight_()),a.left.isRed_()&&a.right.isRed_()&&(a=a.colorFlip_()),a}moveRedLeft_(){let a=this.colorFlip_();return a.right.left.isRed_()&&(a=(a=(a=a.copy(null,null,null,null,a.right.rotateRight_())).rotateLeft_()).colorFlip_()),a}moveRedRight_(){let a=this.colorFlip_();return a.left.left.isRed_()&&(a=(a=a.rotateRight_()).colorFlip_()),a}rotateLeft_(){let a=this.copy(null,null,aW.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight_(){let a=this.copy(null,null,aW.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip_(){let a=this.left.copy(null,null,!this.left.color,null,null),b=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,b)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let a=this.left.check_();if(a===this.right.check_())return a+ +!this.isRed_();throw Error("Black depths differ")}}aW.RED=!0,aW.BLACK=!1;class aX{copy(a,b,c,d,e){return this}insert(a,b,c){return new aW(a,b,null)}remove(a,b){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class aY{constructor(a,b=aY.EMPTY_NODE){this.comparator_=a,this.root_=b}insert(a,b){return new aY(this.comparator_,this.root_.insert(a,b,this.comparator_).copy(null,null,aW.BLACK,null,null))}remove(a){return new aY(this.comparator_,this.root_.remove(a,this.comparator_).copy(null,null,aW.BLACK,null,null))}get(a){let b,c=this.root_;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))return c.value;b<0?c=c.left:b>0&&(c=c.right)}return null}getPredecessorKey(a){let b,c=this.root_,d=null;for(;!c.isEmpty();){if(0===(b=this.comparator_(a,c.key)))if(c.left.isEmpty())if(d)return d.key;else return null;else{for(c=c.left;!c.right.isEmpty();)c=c.right;return c.key}b<0?c=c.left:b>0&&(d=c,c=c.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(a){return this.root_.inorderTraversal(a)}reverseTraversal(a){return this.root_.reverseTraversal(a)}getIterator(a){return new aV(this.root_,null,this.comparator_,!1,a)}getIteratorFrom(a,b){return new aV(this.root_,a,this.comparator_,!1,b)}getReverseIteratorFrom(a,b){return new aV(this.root_,a,this.comparator_,!0,b)}getReverseIterator(a){return new aV(this.root_,null,this.comparator_,!0,a)}}function aZ(a,b){return S(a.name,b.name)}function a$(a,b){return S(a,b)}aY.EMPTY_NODE=new aX;let a_=function(a){return"number"==typeof a?"number:"+Y(a):"string:"+a},a0=function(a){if(a.isLeafNode()){let b=a.val();(0,p.vA)("string"==typeof b||"number"==typeof b||"object"==typeof b&&(0,p.gR)(b,".sv"),"Priority must be a string or number.")}else(0,p.vA)(a===e||a.isEmpty(),"priority of unexpected type.");(0,p.vA)(a===e||a.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class a1{static set __childrenNodeConstructor(a){f=a}static get __childrenNodeConstructor(){return f}constructor(a,b=a1.__childrenNodeConstructor.EMPTY_NODE){this.value_=a,this.priorityNode_=b,this.lazyHash_=null,(0,p.vA)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),a0(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(a){return new a1(this.value_,a)}getImmediateChild(a){return".priority"===a?this.priorityNode_:a1.__childrenNodeConstructor.EMPTY_NODE}getChild(a){return aH(a)?this:".priority"===aA(a)?this.priorityNode_:a1.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(a,b){return null}updateImmediateChild(a,b){return".priority"===a?this.updatePriority(b):b.isEmpty()&&".priority"!==a?this:a1.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(a,b).updatePriority(this.priorityNode_)}updateChild(a,b){let c=aA(a);return null===c?b:b.isEmpty()&&".priority"!==c?this:((0,p.vA)(".priority"!==c||1===aB(a),".priority must be the last token in a path"),this.updateImmediateChild(c,a1.__childrenNodeConstructor.EMPTY_NODE.updateChild(aC(a),b)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(a,b){return!1}val(a){return a&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let a="";this.priorityNode_.isEmpty()||(a+="priority:"+a_(this.priorityNode_.val())+":");let b=typeof this.value_;a+=b+":","number"===b?a+=Y(this.value_):a+=this.value_,this.lazyHash_=D(a)}return this.lazyHash_}getValue(){return this.value_}compareTo(a){return a===a1.__childrenNodeConstructor.EMPTY_NODE?1:a instanceof a1.__childrenNodeConstructor?-1:((0,p.vA)(a.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(a))}compareToLeafNode_(a){let b=typeof a.value_,c=typeof this.value_,d=a1.VALUE_TYPE_ORDER.indexOf(b),e=a1.VALUE_TYPE_ORDER.indexOf(c);return((0,p.vA)(d>=0,"Unknown leaf type: "+b),(0,p.vA)(e>=0,"Unknown leaf type: "+c),d!==e)?e-d:"object"===c?0:this.value_<a.value_?-1:1*(this.value_!==a.value_)}withIndex(){return this}isIndexed(){return!0}equals(a){return a===this||!!a.isLeafNode()&&this.value_===a.value_&&this.priorityNode_.equals(a.priorityNode_)}}a1.VALUE_TYPE_ORDER=["object","boolean","number","string"];class a2 extends aS{compare(a,b){let c=a.node.getPriority(),d=b.node.getPriority(),e=c.compareTo(d);return 0===e?S(a.name,b.name):e}isDefinedOn(a){return!a.getPriority().isEmpty()}indexedValueChanged(a,b){return!a.getPriority().equals(b.getPriority())}minPost(){return aR.MIN}maxPost(){return new aR(R,new a1("[PRIORITY-POST]",h))}makePost(a,b){return new aR(b,new a1("[PRIORITY-POST]",g(a)))}toString(){return".priority"}}let a3=new a2,a4=Math.log(2);class a5{constructor(a){this.count=parseInt(Math.log(a+1)/a4,10),this.current_=this.count-1;let b=parseInt(Array(this.count+1).join("1"),2);this.bits_=a+1&b}nextBitIsOne(){let a=!(this.bits_&1<<this.current_);return this.current_--,a}}let a6=function(a,b,c,d){a.sort(b);let e=function(b,d){let f,g=d-b;if(0===g)return null;if(1===g)return f=a[b],new aW(c?c(f):f,f.node,aW.BLACK,null,null);{let h=parseInt(g/2,10)+b,i=e(b,h),j=e(h+1,d);return f=a[h],new aW(c?c(f):f,f.node,aW.BLACK,i,j)}};return new aY(d||b,function(b){let d=null,f=null,g=a.length,h=function(b,d){let f=g-b,h=g;g-=b;let j=e(f+1,h),k=a[f];i(new aW(c?c(k):k,k.node,d,null,j))},i=function(a){d?d.left=a:f=a,d=a};for(let a=0;a<b.count;++a){let c=b.nextBitIsOne(),d=Math.pow(2,b.count-(a+1));c?h(d,aW.BLACK):(h(d,aW.BLACK),h(d,aW.RED))}return f}(new a5(a.length)))},a7={};class a8{static get Default(){return(0,p.vA)(a7&&a3,"ChildrenNode.ts has not been loaded"),i=i||new a8({".priority":a7},{".priority":a3})}constructor(a,b){this.indexes_=a,this.indexSet_=b}get(a){let b=(0,p.yw)(this.indexes_,a);if(!b)throw Error("No index defined for "+a);return b instanceof aY?b:null}hasIndex(a){return(0,p.gR)(this.indexSet_,a.toString())}addIndex(a,b){let c;(0,p.vA)(a!==aU,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let d=[],e=!1,f=b.getIterator(aR.Wrap),g=f.getNext();for(;g;)e=e||a.isDefinedOn(g.node),d.push(g),g=f.getNext();c=e?a6(d,a.getCompare()):a7;let h=a.toString(),i=Object.assign({},this.indexSet_);i[h]=a;let j=Object.assign({},this.indexes_);return j[h]=c,new a8(j,i)}addToIndexes(a,b){return new a8((0,p.kH)(this.indexes_,(c,d)=>{let e=(0,p.yw)(this.indexSet_,d);if((0,p.vA)(e,"Missing index implementation for "+d),c===a7)if(!e.isDefinedOn(a.node))return a7;else{let c=[],d=b.getIterator(aR.Wrap),f=d.getNext();for(;f;)f.name!==a.name&&c.push(f),f=d.getNext();return c.push(a),a6(c,e.getCompare())}{let d=b.get(a.name),e=c;return d&&(e=e.remove(new aR(a.name,d))),e.insert(a,a.node)}}),this.indexSet_)}removeFromIndexes(a,b){return new a8((0,p.kH)(this.indexes_,c=>{if(c===a7)return c;{let d=b.get(a.name);return d?c.remove(new aR(a.name,d)):c}}),this.indexSet_)}}class a9{static get EMPTY_NODE(){return j||(j=new a9(new aY(a$),null,a8.Default))}constructor(a,b,c){this.children_=a,this.priorityNode_=b,this.indexMap_=c,this.lazyHash_=null,this.priorityNode_&&a0(this.priorityNode_),this.children_.isEmpty()&&(0,p.vA)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||j}updatePriority(a){return this.children_.isEmpty()?this:new a9(this.children_,a,this.indexMap_)}getImmediateChild(a){if(".priority"===a)return this.getPriority();{let b=this.children_.get(a);return null===b?j:b}}getChild(a){let b=aA(a);return null===b?this:this.getImmediateChild(b).getChild(aC(a))}hasChild(a){return null!==this.children_.get(a)}updateImmediateChild(a,b){if((0,p.vA)(b,"We should always be passing snapshot nodes"),".priority"===a)return this.updatePriority(b);{let c,d,e=new aR(a,b);b.isEmpty()?(c=this.children_.remove(a),d=this.indexMap_.removeFromIndexes(e,this.children_)):(c=this.children_.insert(a,b),d=this.indexMap_.addToIndexes(e,this.children_));let f=c.isEmpty()?j:this.priorityNode_;return new a9(c,f,d)}}updateChild(a,b){let c=aA(a);if(null===c)return b;{(0,p.vA)(".priority"!==aA(a)||1===aB(a),".priority must be the last token in a path");let d=this.getImmediateChild(c).updateChild(aC(a),b);return this.updateImmediateChild(c,d)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(a){if(this.isEmpty())return null;let b={},c=0,d=0,e=!0;if(this.forEachChild(a3,(f,g)=>{b[f]=g.val(a),c++,e&&a9.INTEGER_REGEXP_.test(f)?d=Math.max(d,Number(f)):e=!1}),a||!e||!(d<2*c))return a&&!this.getPriority().isEmpty()&&(b[".priority"]=this.getPriority().val()),b;{let a=[];for(let c in b)a[c]=b[c];return a}}hash(){if(null===this.lazyHash_){let a="";this.getPriority().isEmpty()||(a+="priority:"+a_(this.getPriority().val())+":"),this.forEachChild(a3,(b,c)=>{let d=c.hash();""!==d&&(a+=":"+b+":"+d)}),this.lazyHash_=""===a?"":D(a)}return this.lazyHash_}getPredecessorChildName(a,b,c){let d=this.resolveIndex_(c);if(!d)return this.children_.getPredecessorKey(a);{let c=d.getPredecessorKey(new aR(a,b));return c?c.name:null}}getFirstChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.minKey();{let a=b.minKey();return a&&a.name}}getFirstChild(a){let b=this.getFirstChildName(a);return b?new aR(b,this.children_.get(b)):null}getLastChildName(a){let b=this.resolveIndex_(a);if(!b)return this.children_.maxKey();{let a=b.maxKey();return a&&a.name}}getLastChild(a){let b=this.getLastChildName(a);return b?new aR(b,this.children_.get(b)):null}forEachChild(a,b){let c=this.resolveIndex_(a);return c?c.inorderTraversal(a=>b(a.name,a.node)):this.children_.inorderTraversal(b)}getIterator(a){return this.getIteratorFrom(a.minPost(),a)}getIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getIteratorFrom(a,a=>a);{let c=this.children_.getIteratorFrom(a.name,aR.Wrap),d=c.peek();for(;null!=d&&0>b.compare(d,a);)c.getNext(),d=c.peek();return c}}getReverseIterator(a){return this.getReverseIteratorFrom(a.maxPost(),a)}getReverseIteratorFrom(a,b){let c=this.resolveIndex_(b);if(c)return c.getReverseIteratorFrom(a,a=>a);{let c=this.children_.getReverseIteratorFrom(a.name,aR.Wrap),d=c.peek();for(;null!=d&&b.compare(d,a)>0;)c.getNext(),d=c.peek();return c}}compareTo(a){if(this.isEmpty())if(a.isEmpty())return 0;else return -1;return a.isLeafNode()||a.isEmpty()?1:a===bb?-1:0}withIndex(a){if(a===aU||this.indexMap_.hasIndex(a))return this;{let b=this.indexMap_.addIndex(a,this.children_);return new a9(this.children_,this.priorityNode_,b)}}isIndexed(a){return a===aU||this.indexMap_.hasIndex(a)}equals(a){if(a===this)return!0;if(a.isLeafNode()||!this.getPriority().equals(a.getPriority()))return!1;if(this.children_.count()!==a.children_.count())return!1;{let b=this.getIterator(a3),c=a.getIterator(a3),d=b.getNext(),e=c.getNext();for(;d&&e;){if(d.name!==e.name||!d.node.equals(e.node))return!1;d=b.getNext(),e=c.getNext()}return null===d&&null===e}}resolveIndex_(a){return a===aU?null:this.indexMap_.get(a.toString())}}a9.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class ba extends a9{constructor(){super(new aY(a$),a9.EMPTY_NODE,a8.Default)}compareTo(a){return+(a!==this)}equals(a){return a===this}getPriority(){return this}getImmediateChild(a){return a9.EMPTY_NODE}isEmpty(){return!1}}let bb=new ba;function bc(a,b=null){if(null===a)return a9.EMPTY_NODE;if("object"==typeof a&&".priority"in a&&(b=a[".priority"]),(0,p.vA)(null===b||"string"==typeof b||"number"==typeof b||"object"==typeof b&&".sv"in b,"Invalid priority type found: "+typeof b),"object"==typeof a&&".value"in a&&null!==a[".value"]&&(a=a[".value"]),"object"!=typeof a||".sv"in a)return new a1(a,bc(b));if(a instanceof Array){let c=a9.EMPTY_NODE;return X(a,(b,d)=>{if((0,p.gR)(a,b)&&"."!==b.substring(0,1)){let a=bc(d);(a.isLeafNode()||!a.isEmpty())&&(c=c.updateImmediateChild(b,a))}}),c.updatePriority(bc(b))}{let c=[],d=!1;if(X(a,(a,b)=>{if("."!==a.substring(0,1)){let e=bc(b);e.isEmpty()||(d=d||!e.getPriority().isEmpty(),c.push(new aR(a,e)))}}),0===c.length)return a9.EMPTY_NODE;let e=a6(c,aZ,a=>a.name,a$);if(!d)return new a9(e,bc(b),a8.Default);{let a=a6(c,a3.getCompare());return new a9(e,bc(b),new a8({".priority":a},{".priority":a3}))}}}Object.defineProperties(aR,{MIN:{value:new aR(Q,a9.EMPTY_NODE)},MAX:{value:new aR(R,bb)}}),aT.__EMPTY_NODE=a9.EMPTY_NODE,a1.__childrenNodeConstructor=a9,e=bb,h=bb,g=bc;class bd extends aS{constructor(a){super(),this.indexPath_=a,(0,p.vA)(!aH(a)&&".priority"!==aA(a),"Can't create PathIndex with empty path or .priority key")}extractChild(a){return a.getChild(this.indexPath_)}isDefinedOn(a){return!a.getChild(this.indexPath_).isEmpty()}compare(a,b){let c=this.extractChild(a.node),d=this.extractChild(b.node),e=c.compareTo(d);return 0===e?S(a.name,b.name):e}makePost(a,b){let c=bc(a);return new aR(b,a9.EMPTY_NODE.updateChild(this.indexPath_,c))}maxPost(){return new aR(R,a9.EMPTY_NODE.updateChild(this.indexPath_,bb))}toString(){return aE(this.indexPath_,0).join("/")}}class be extends aS{compare(a,b){let c=a.node.compareTo(b.node);return 0===c?S(a.name,b.name):c}isDefinedOn(a){return!0}indexedValueChanged(a,b){return!a.equals(b)}minPost(){return aR.MIN}maxPost(){return aR.MAX}makePost(a,b){return new aR(b,bc(a))}toString(){return".value"}}let bf=new be;function bg(a){return{type:"value",snapshotNode:a}}function bh(a,b){return{type:"child_added",snapshotNode:b,childName:a}}function bi(a,b){return{type:"child_removed",snapshotNode:b,childName:a}}function bj(a,b,c){return{type:"child_changed",snapshotNode:b,childName:a,oldSnap:c}}class bk{constructor(a){this.index_=a}updateChild(a,b,c,d,e,f){(0,p.vA)(a.isIndexed(this.index_),"A node must be indexed if only a child is updated");let g=a.getImmediateChild(b);return g.getChild(d).equals(c.getChild(d))&&g.isEmpty()===c.isEmpty()||(null!=f&&(c.isEmpty()?a.hasChild(b)?f.trackChildChange(bi(b,g)):(0,p.vA)(a.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):g.isEmpty()?f.trackChildChange(bh(b,c)):f.trackChildChange(bj(b,c,g))),a.isLeafNode()&&c.isEmpty())?a:a.updateImmediateChild(b,c).withIndex(this.index_)}updateFullNode(a,b,c){return null!=c&&(a.isLeafNode()||a.forEachChild(a3,(a,d)=>{b.hasChild(a)||c.trackChildChange(bi(a,d))}),b.isLeafNode()||b.forEachChild(a3,(b,d)=>{if(a.hasChild(b)){let e=a.getImmediateChild(b);e.equals(d)||c.trackChildChange(bj(b,d,e))}else c.trackChildChange(bh(b,d))})),b.withIndex(this.index_)}updatePriority(a,b){return a.isEmpty()?a9.EMPTY_NODE:a.updatePriority(b)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class bl{constructor(a){this.indexedFilter_=new bk(a.getIndex()),this.index_=a.getIndex(),this.startPost_=bl.getStartPost_(a),this.endPost_=bl.getEndPost_(a),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(a){let b=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),a):0>this.index_.compare(this.getStartPost(),a),c=this.endIsInclusive_?0>=this.index_.compare(a,this.getEndPost()):0>this.index_.compare(a,this.getEndPost());return b&&c}updateChild(a,b,c,d,e,f){return this.matches(new aR(b,c))||(c=a9.EMPTY_NODE),this.indexedFilter_.updateChild(a,b,c,d,e,f)}updateFullNode(a,b,c){b.isLeafNode()&&(b=a9.EMPTY_NODE);let d=b.withIndex(this.index_);d=d.updatePriority(a9.EMPTY_NODE);let e=this;return b.forEachChild(a3,(a,b)=>{e.matches(new aR(a,b))||(d=d.updateImmediateChild(a,a9.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(a){if(!a.hasStart())return a.getIndex().minPost();{let b=a.getIndexStartName();return a.getIndex().makePost(a.getIndexStartValue(),b)}}static getEndPost_(a){if(!a.hasEnd())return a.getIndex().maxPost();{let b=a.getIndexEndName();return a.getIndex().makePost(a.getIndexEndValue(),b)}}}class bm{constructor(a){this.withinDirectionalStart=a=>this.reverse_?this.withinEndPost(a):this.withinStartPost(a),this.withinDirectionalEnd=a=>this.reverse_?this.withinStartPost(a):this.withinEndPost(a),this.withinStartPost=a=>{let b=this.index_.compare(this.rangedFilter_.getStartPost(),a);return this.startIsInclusive_?b<=0:b<0},this.withinEndPost=a=>{let b=this.index_.compare(a,this.rangedFilter_.getEndPost());return this.endIsInclusive_?b<=0:b<0},this.rangedFilter_=new bl(a),this.index_=a.getIndex(),this.limit_=a.getLimit(),this.reverse_=!a.isViewFromLeft(),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}updateChild(a,b,c,d,e,f){return(this.rangedFilter_.matches(new aR(b,c))||(c=a9.EMPTY_NODE),a.getImmediateChild(b).equals(c))?a:a.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(a,b,c,d,e,f):this.fullLimitUpdateChild_(a,b,c,e,f)}updateFullNode(a,b,c){let d;if(b.isLeafNode()||b.isEmpty())d=a9.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<b.numChildren()&&b.isIndexed(this.index_)){let a;d=a9.EMPTY_NODE.withIndex(this.index_),a=this.reverse_?b.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):b.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let c=0;for(;a.hasNext()&&c<this.limit_;){let b=a.getNext();if(this.withinDirectionalStart(b))if(this.withinDirectionalEnd(b))d=d.updateImmediateChild(b.name,b.node),c++;else break}}else{let a;d=(d=b.withIndex(this.index_)).updatePriority(a9.EMPTY_NODE),a=this.reverse_?d.getReverseIterator(this.index_):d.getIterator(this.index_);let c=0;for(;a.hasNext();){let b=a.getNext();c<this.limit_&&this.withinDirectionalStart(b)&&this.withinDirectionalEnd(b)?c++:d=d.updateImmediateChild(b.name,a9.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(a,d,c)}updatePriority(a,b){return a}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(a,b,c,d,e){let f;if(this.reverse_){let a=this.index_.getCompare();f=(b,c)=>a(c,b)}else f=this.index_.getCompare();(0,p.vA)(a.numChildren()===this.limit_,"");let g=new aR(b,c),h=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),i=this.rangedFilter_.matches(g);if(a.hasChild(b)){let j=a.getImmediateChild(b),k=d.getChildAfterChild(this.index_,h,this.reverse_);for(;null!=k&&(k.name===b||a.hasChild(k.name));)k=d.getChildAfterChild(this.index_,k,this.reverse_);let l=null==k?1:f(k,g);if(i&&!c.isEmpty()&&l>=0)return null!=e&&e.trackChildChange(bj(b,c,j)),a.updateImmediateChild(b,c);{null!=e&&e.trackChildChange(bi(b,j));let c=a.updateImmediateChild(b,a9.EMPTY_NODE);return null!=k&&this.rangedFilter_.matches(k)?(null!=e&&e.trackChildChange(bh(k.name,k.node)),c.updateImmediateChild(k.name,k.node)):c}}return c.isEmpty()?a:i?f(h,g)>=0?(null!=e&&(e.trackChildChange(bi(h.name,h.node)),e.trackChildChange(bh(b,c))),a.updateImmediateChild(b,c).updateImmediateChild(h.name,a9.EMPTY_NODE)):a:a}}class bn{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=a3}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,p.vA)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return((0,p.vA)(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:Q}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,p.vA)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return((0,p.vA)(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:R}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,p.vA)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===a3}copy(){let a=new bn;return a.limitSet_=this.limitSet_,a.limit_=this.limit_,a.startSet_=this.startSet_,a.startAfterSet_=this.startAfterSet_,a.indexStartValue_=this.indexStartValue_,a.startNameSet_=this.startNameSet_,a.indexStartName_=this.indexStartName_,a.endSet_=this.endSet_,a.endBeforeSet_=this.endBeforeSet_,a.indexEndValue_=this.indexEndValue_,a.endNameSet_=this.endNameSet_,a.indexEndName_=this.indexEndName_,a.index_=this.index_,a.viewFrom_=this.viewFrom_,a}}function bo(a){let b,c={};if(a.isDefault())return c;if(a.index_===a3?b="$priority":a.index_===bf?b="$value":a.index_===aU?b="$key":((0,p.vA)(a.index_ instanceof bd,"Unrecognized index type!"),b=a.index_.toString()),c.orderBy=(0,p.As)(b),a.startSet_){let b=a.startAfterSet_?"startAfter":"startAt";c[b]=(0,p.As)(a.indexStartValue_),a.startNameSet_&&(c[b]+=","+(0,p.As)(a.indexStartName_))}if(a.endSet_){let b=a.endBeforeSet_?"endBefore":"endAt";c[b]=(0,p.As)(a.indexEndValue_),a.endNameSet_&&(c[b]+=","+(0,p.As)(a.indexEndName_))}return a.limitSet_&&(a.isViewFromLeft()?c.limitToFirst=a.limit_:c.limitToLast=a.limit_),c}function bp(a){let b={};if(a.startSet_&&(b.sp=a.indexStartValue_,a.startNameSet_&&(b.sn=a.indexStartName_),b.sin=!a.startAfterSet_),a.endSet_&&(b.ep=a.indexEndValue_,a.endNameSet_&&(b.en=a.indexEndName_),b.ein=!a.endBeforeSet_),a.limitSet_){b.l=a.limit_;let c=a.viewFrom_;""===c&&(c=a.isViewFromLeft()?"l":"r"),b.vf=c}return a.index_!==a3&&(b.i=a.index_.toString()),b}class bq extends av{reportStats(a){throw Error("Method not implemented.")}static getListenId_(a,b){return void 0!==b?"tag$"+b:((0,p.vA)(a._queryParams.isDefault(),"should have a tag if it's not a default query."),a._path.toString())}constructor(a,b,c,d){super(),this.repoInfo_=a,this.onDataUpdate_=b,this.authTokenProvider_=c,this.appCheckTokenProvider_=d,this.log_=J("p:rest:"),this.listens_={}}listen(a,b,c,d){let e=a._path.toString();this.log_("Listen called for "+e+" "+a._queryIdentifier);let f=bq.getListenId_(a,c),g={};this.listens_[f]=g;let h=bo(a._queryParams);this.restRequest_(e+".json",h,(a,b)=>{let h=b;(404===a&&(h=null,a=null),null===a&&this.onDataUpdate_(e,h,!1,c),(0,p.yw)(this.listens_,f)===g)&&d(a?401===a?"permission_denied":"rest_error:"+a:"ok",null)})}unlisten(a,b){let c=bq.getListenId_(a,b);delete this.listens_[c]}get(a){let b=bo(a._queryParams),c=a._path.toString(),d=new p.cY;return this.restRequest_(c+".json",b,(a,b)=>{let e=b;404===a&&(e=null,a=null),null===a?(this.onDataUpdate_(c,e,!1,null),d.resolve(e)):d.reject(Error(e))}),d.promise}refreshAuthToken(a){}restRequest_(a,b={},c){return b.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([d,e])=>{d&&d.accessToken&&(b.auth=d.accessToken),e&&e.token&&(b.ac=e.token);let f=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+a+"?ns="+this.repoInfo_.namespace+(0,p.Am)(b);this.log_("Sending REST request for "+f);let g=new XMLHttpRequest;g.onreadystatechange=()=>{if(c&&4===g.readyState){this.log_("REST Response for "+f+" received. status:",g.status,"response:",g.responseText);let a=null;if(g.status>=200&&g.status<300){try{a=(0,p.$L)(g.responseText)}catch(a){M("Failed to parse JSON response for "+f+": "+g.responseText)}c(null,a)}else 401!==g.status&&404!==g.status&&M("Got unsuccessful REST response for "+f+" Status: "+g.status),c(g.status);c=null}},g.open("GET",f,!0),g.send()})}}class br{constructor(){this.rootNode_=a9.EMPTY_NODE}getNode(a){return this.rootNode_.getChild(a)}updateSnapshot(a,b){this.rootNode_=this.rootNode_.updateChild(a,b)}}function bs(){return{value:null,children:new Map}}function bt(a,b,c){var d,e;null!==a.value?c(b,a.value):(d=a,e=(a,d)=>{bt(d,new ay(b.toString()+"/"+a),c)},d.children.forEach((a,b)=>{e(b,a)}))}class bu{constructor(a){this.collection_=a,this.last_=null}get(){let a=this.collection_.get(),b=Object.assign({},a);return this.last_&&X(this.last_,(a,c)=>{b[a]=b[a]-c}),this.last_=a,b}}class bv{constructor(a,b){this.server_=b,this.statsToReport_={},this.statsListener_=new bu(a);let c=1e4+2e4*Math.random();aa(this.reportStats_.bind(this),Math.floor(c))}reportStats_(){let a=this.statsListener_.get(),b={},c=!1;X(a,(a,d)=>{d>0&&(0,p.gR)(this.statsToReport_,a)&&(b[a]=d,c=!0)}),c&&this.server_.reportStats(b),aa(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function bw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function bx(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function by(a){return{fromUser:!1,fromServer:!0,queryId:a,tagged:!0}}!function(a){a[a.OVERWRITE=0]="OVERWRITE",a[a.MERGE=1]="MERGE",a[a.ACK_USER_WRITE=2]="ACK_USER_WRITE",a[a.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(n||(n={}));class bz{constructor(a,b,c){this.path=a,this.affectedTree=b,this.revert=c,this.type=n.ACK_USER_WRITE,this.source=bw()}operationForChild(a){if(!aH(this.path))return(0,p.vA)(aA(this.path)===a,"operationForChild called for unrelated child."),new bz(aC(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return(0,p.vA)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let b=this.affectedTree.subtree(new ay(a));return new bz(az(),b,this.revert)}}}class bA{constructor(a,b){this.source=a,this.path=b,this.type=n.LISTEN_COMPLETE}operationForChild(a){return aH(this.path)?new bA(this.source,az()):new bA(this.source,aC(this.path))}}class bB{constructor(a,b,c){this.source=a,this.path=b,this.snap=c,this.type=n.OVERWRITE}operationForChild(a){return aH(this.path)?new bB(this.source,az(),this.snap.getImmediateChild(a)):new bB(this.source,aC(this.path),this.snap)}}class bC{constructor(a,b,c){this.source=a,this.path=b,this.children=c,this.type=n.MERGE}operationForChild(a){if(!aH(this.path))return(0,p.vA)(aA(this.path)===a,"Can't get a merge for a child not on the path of the operation"),new bC(this.source,aC(this.path),this.children);{let b=this.children.subtree(new ay(a));return b.isEmpty()?null:b.value?new bB(this.source,az(),b.value):new bC(this.source,az(),b)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class bD{constructor(a,b,c){this.node_=a,this.fullyInitialized_=b,this.filtered_=c}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(a){if(aH(a))return this.isFullyInitialized()&&!this.filtered_;let b=aA(a);return this.isCompleteForChild(b)}isCompleteForChild(a){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(a)}getNode(){return this.node_}}class bE{constructor(a){this.query_=a,this.index_=this.query_._queryParams.getIndex()}}function bF(a,b,c,d,e,f){let g=d.filter(a=>a.type===c);g.sort((b,c)=>(function(a,b,c){if(null==b.childName||null==c.childName)throw(0,p.Hk)("Should only compare child_ events.");let d=new aR(b.childName,b.snapshotNode),e=new aR(c.childName,c.snapshotNode);return a.index_.compare(d,e)})(a,b,c)),g.forEach(c=>{var d,g,h;let i=(d=a,g=c,h=f,"value"===g.type||"child_removed"===g.type||(g.prevName=h.getPredecessorChildName(g.childName,g.snapshotNode,d.index_)),g);e.forEach(d=>{d.respondsTo(c.type)&&b.push(d.createEvent(i,a.query_))})})}function bG(a,b){return{eventCache:a,serverCache:b}}function bH(a,b,c,d){return bG(new bD(b,c,d),a.serverCache)}function bI(a,b,c,d){return bG(a.eventCache,new bD(b,c,d))}function bJ(a){return a.eventCache.isFullyInitialized()?a.eventCache.getNode():null}function bK(a){return a.serverCache.isFullyInitialized()?a.serverCache.getNode():null}class bL{static fromObject(a){let b=new bL(null);return X(a,(a,c)=>{b=b.set(new ay(a),c)}),b}constructor(a,b=(!k&&(k=new aY(T)),k)){this.value=a,this.children=b}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(a,b){if(null!=this.value&&b(this.value))return{path:az(),value:this.value};{if(aH(a))return null;let c=aA(a),d=this.children.get(c);if(null===d)return null;{let e=d.findRootMostMatchingPathAndValue(aC(a),b);return null!=e?{path:aG(new ay(c),e.path),value:e.value}:null}}}findRootMostValueAndPath(a){return this.findRootMostMatchingPathAndValue(a,()=>!0)}subtree(a){if(aH(a))return this;{let b=aA(a),c=this.children.get(b);return null!==c?c.subtree(aC(a)):new bL(null)}}set(a,b){if(aH(a))return new bL(b,this.children);{let c=aA(a),d=(this.children.get(c)||new bL(null)).set(aC(a),b),e=this.children.insert(c,d);return new bL(this.value,e)}}remove(a){if(aH(a))if(this.children.isEmpty())return new bL(null);else return new bL(null,this.children);{let b=aA(a),c=this.children.get(b);if(!c)return this;{let d,e=c.remove(aC(a));return(d=e.isEmpty()?this.children.remove(b):this.children.insert(b,e),null===this.value&&d.isEmpty())?new bL(null):new bL(this.value,d)}}}get(a){if(aH(a))return this.value;{let b=aA(a),c=this.children.get(b);return c?c.get(aC(a)):null}}setTree(a,b){if(aH(a))return b;{let c,d=aA(a),e=(this.children.get(d)||new bL(null)).setTree(aC(a),b);return c=e.isEmpty()?this.children.remove(d):this.children.insert(d,e),new bL(this.value,c)}}fold(a){return this.fold_(az(),a)}fold_(a,b){let c={};return this.children.inorderTraversal((d,e)=>{c[d]=e.fold_(aG(a,d),b)}),b(a,this.value,c)}findOnPath(a,b){return this.findOnPath_(a,az(),b)}findOnPath_(a,b,c){let d=!!this.value&&c(b,this.value);if(d)return d;{if(aH(a))return null;let d=aA(a),e=this.children.get(d);return e?e.findOnPath_(aC(a),aG(b,d),c):null}}foreachOnPath(a,b){return this.foreachOnPath_(a,az(),b)}foreachOnPath_(a,b,c){if(aH(a))return this;{this.value&&c(b,this.value);let d=aA(a),e=this.children.get(d);return e?e.foreachOnPath_(aC(a),aG(b,d),c):new bL(null)}}foreach(a){this.foreach_(az(),a)}foreach_(a,b){this.children.inorderTraversal((c,d)=>{d.foreach_(aG(a,c),b)}),this.value&&b(a,this.value)}foreachChild(a){this.children.inorderTraversal((b,c)=>{c.value&&a(b,c.value)})}}class bM{constructor(a){this.writeTree_=a}static empty(){return new bM(new bL(null))}}function bN(a,b,c){if(aH(b))return new bM(new bL(c));{let d=a.writeTree_.findRootMostValueAndPath(b);if(null!=d){let e=d.path,f=d.value,g=aI(e,b);return f=f.updateChild(g,c),new bM(a.writeTree_.set(e,f))}{let d=new bL(c);return new bM(a.writeTree_.setTree(b,d))}}}function bO(a,b,c){let d=a;return X(c,(a,c)=>{d=bN(d,aG(b,a),c)}),d}function bP(a,b){return aH(b)?bM.empty():new bM(a.writeTree_.setTree(b,new bL(null)))}function bQ(a,b){return null!=bR(a,b)}function bR(a,b){let c=a.writeTree_.findRootMostValueAndPath(b);return null!=c?a.writeTree_.get(c.path).getChild(aI(c.path,b)):null}function bS(a){let b=[],c=a.writeTree_.value;return null!=c?c.isLeafNode()||c.forEachChild(a3,(a,c)=>{b.push(new aR(a,c))}):a.writeTree_.children.inorderTraversal((a,c)=>{null!=c.value&&b.push(new aR(a,c.value))}),b}function bT(a,b){if(aH(b))return a;{let c=bR(a,b);return new bM(null!=c?new bL(c):a.writeTree_.subtree(b))}}function bU(a){return a.writeTree_.isEmpty()}function bV(a,b){return function a(b,c,d){if(null!=c.value)return d.updateChild(b,c.value);{let e=null;return c.children.inorderTraversal((c,f)=>{".priority"===c?((0,p.vA)(null!==f.value,"Priority writes must always be leaf nodes"),e=f.value):d=a(aG(b,c),f,d)}),d.getChild(b).isEmpty()||null===e||(d=d.updateChild(aG(b,".priority"),e)),d}}(az(),a.writeTree_,b)}function bW(a){return a.visible}function bX(a,b,c){let d=bM.empty();for(let e=0;e<a.length;++e){let f=a[e];if(b(f)){let a,b=f.path;if(f.snap)aL(c,b)?d=bN(d,a=aI(c,b),f.snap):aL(b,c)&&(a=aI(b,c),d=bN(d,az(),f.snap.getChild(a)));else if(f.children){if(aL(c,b))d=bO(d,a=aI(c,b),f.children);else if(aL(b,c))if(aH(a=aI(b,c)))d=bO(d,az(),f.children);else{let b=(0,p.yw)(f.children,aA(a));if(b){let c=b.getChild(aC(a));d=bN(d,az(),c)}}}else throw(0,p.Hk)("WriteRecord should have .snap or .children")}}return d}function bY(a,b,c,d,e){if(d||e){let f=bT(a.visibleWrites,b);return!e&&bU(f)?c:e||null!=c||bQ(f,az())?bV(bX(a.allWrites,function(a){return(a.visible||e)&&(!d||!~d.indexOf(a.writeId))&&(aL(a.path,b)||aL(b,a.path))},b),c||a9.EMPTY_NODE):null}{let d=bR(a.visibleWrites,b);if(null!=d)return d;{let d=bT(a.visibleWrites,b);return bU(d)?c:null!=c||bQ(d,az())?bV(d,c||a9.EMPTY_NODE):null}}}function bZ(a,b,c,d){return bY(a.writeTree,a.treePath,b,c,d)}function b$(a,b){return function(a,b,c){let d=a9.EMPTY_NODE,e=bR(a.visibleWrites,b);if(e)return e.isLeafNode()||e.forEachChild(a3,(a,b)=>{d=d.updateImmediateChild(a,b)}),d;if(!c)return bS(bT(a.visibleWrites,b)).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d;{let e=bT(a.visibleWrites,b);return c.forEachChild(a3,(a,b)=>{let c=bV(bT(e,new ay(a)),b);d=d.updateImmediateChild(a,c)}),bS(e).forEach(a=>{d=d.updateImmediateChild(a.name,a.node)}),d}}(a.writeTree,a.treePath,b)}function b_(a,b,c,d){return function(a,b,c,d,e){(0,p.vA)(d||e,"Either existingEventSnap or existingServerSnap must exist");let f=aG(b,c);if(bQ(a.visibleWrites,f))return null;{let b=bT(a.visibleWrites,f);return bU(b)?e.getChild(c):bV(b,e.getChild(c))}}(a.writeTree,a.treePath,b,c,d)}function b0(a,b){var c,d;return c=a.writeTree,d=aG(a.treePath,b),bR(c.visibleWrites,d)}function b1(a,b,c){return function(a,b,c,d){let e=aG(b,c),f=bR(a.visibleWrites,e);return null!=f?f:d.isCompleteForChild(c)?bV(bT(a.visibleWrites,e),d.getNode().getImmediateChild(c)):null}(a.writeTree,a.treePath,b,c)}function b2(a,b){return b3(aG(a.treePath,b),a.writeTree)}function b3(a,b){return{treePath:a,writeTree:b}}class b4{constructor(){this.changeMap=new Map}trackChildChange(a){let b=a.type,c=a.childName;(0,p.vA)("child_added"===b||"child_changed"===b||"child_removed"===b,"Only child changes supported for tracking"),(0,p.vA)(".priority"!==c,"Only non-priority child changes can be tracked.");let d=this.changeMap.get(c);if(d){let e=d.type;if("child_added"===b&&"child_removed"===e)this.changeMap.set(c,bj(c,a.snapshotNode,d.snapshotNode));else if("child_removed"===b&&"child_added"===e)this.changeMap.delete(c);else if("child_removed"===b&&"child_changed"===e)this.changeMap.set(c,bi(c,d.oldSnap));else if("child_changed"===b&&"child_added"===e)this.changeMap.set(c,bh(c,a.snapshotNode));else if("child_changed"===b&&"child_changed"===e)this.changeMap.set(c,bj(c,a.snapshotNode,d.oldSnap));else throw(0,p.Hk)("Illegal combination of changes: "+a+" occurred after "+d)}else this.changeMap.set(c,a)}getChanges(){return Array.from(this.changeMap.values())}}class b5{getCompleteChild(a){return null}getChildAfterChild(a,b,c){return null}}let b6=new b5;class b7{constructor(a,b,c=null){this.writes_=a,this.viewCache_=b,this.optCompleteServerCache_=c}getCompleteChild(a){let b=this.viewCache_.eventCache;if(b.isCompleteForChild(a))return b.getNode().getImmediateChild(a);{let b=null!=this.optCompleteServerCache_?new bD(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return b1(this.writes_,a,b)}}getChildAfterChild(a,b,c){var d;let e=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:bK(this.viewCache_),f=(d=this.writes_,function(a,b,c,d,e,f,g){let h,i=bT(a.visibleWrites,b),j=bR(i,az());if(null!=j)h=j;else{if(null==c)return[];h=bV(i,c)}if((h=h.withIndex(g)).isEmpty()||h.isLeafNode())return[];{let a=[],b=g.getCompare(),c=f?h.getReverseIteratorFrom(d,g):h.getIteratorFrom(d,g),e=c.getNext();for(;e&&a.length<1;)0!==b(e,d)&&a.push(e),e=c.getNext();return a}}(d.writeTree,d.treePath,e,b,1,c,a));return 0===f.length?null:f[0]}}function b8(a,b,c,d,e,f){let g=b.eventCache;if(null!=b0(d,c))return b;{let h,i;if(aH(c))if((0,p.vA)(b.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),b.serverCache.isFiltered()){let c=bK(b),e=b$(d,c instanceof a9?c:a9.EMPTY_NODE);h=a.filter.updateFullNode(b.eventCache.getNode(),e,f)}else{let c=bZ(d,bK(b));h=a.filter.updateFullNode(b.eventCache.getNode(),c,f)}else{let j=aA(c);if(".priority"===j){(0,p.vA)(1===aB(c),"Can't have a priority with additional path components");let e=g.getNode(),f=b_(d,c,e,i=b.serverCache.getNode());h=null!=f?a.filter.updatePriority(e,f):g.getNode()}else{let k,l=aC(c);if(g.isCompleteForChild(j)){i=b.serverCache.getNode();let a=b_(d,c,g.getNode(),i);k=null!=a?g.getNode().getImmediateChild(j).updateChild(l,a):g.getNode().getImmediateChild(j)}else k=b1(d,j,b.serverCache);h=null!=k?a.filter.updateChild(g.getNode(),j,k,l,e,f):g.getNode()}}return bH(b,h,g.isFullyInitialized()||aH(c),a.filter.filtersNodes())}}function b9(a,b,c,d,e,f,g,h){let i,j=b.serverCache,k=g?a.filter:a.filter.getIndexedFilter();if(aH(c))i=k.updateFullNode(j.getNode(),d,null);else if(k.filtersNodes()&&!j.isFiltered()){let a=j.getNode().updateChild(c,d);i=k.updateFullNode(j.getNode(),a,null)}else{let a=aA(c);if(!j.isCompleteForPath(c)&&aB(c)>1)return b;let e=aC(c),f=j.getNode().getImmediateChild(a).updateChild(e,d);i=".priority"===a?k.updatePriority(j.getNode(),f):k.updateChild(j.getNode(),a,f,e,b6,null)}let l=bI(b,i,j.isFullyInitialized()||aH(c),k.filtersNodes()),m=new b7(e,l,f);return b8(a,l,c,e,m,h)}function ca(a,b,c,d,e,f,g){let h,i,j=b.eventCache,k=new b7(e,b,f);if(aH(c))i=a.filter.updateFullNode(b.eventCache.getNode(),d,g),h=bH(b,i,!0,a.filter.filtersNodes());else{let e=aA(c);if(".priority"===e)i=a.filter.updatePriority(b.eventCache.getNode(),d),h=bH(b,i,j.isFullyInitialized(),j.isFiltered());else{let f,i=aC(c),l=j.getNode().getImmediateChild(e);if(aH(i))f=d;else{let a=k.getCompleteChild(e);f=null!=a?".priority"===aD(i)&&a.getChild(aF(i)).isEmpty()?a:a.updateChild(i,d):a9.EMPTY_NODE}h=l.equals(f)?b:bH(b,a.filter.updateChild(j.getNode(),e,f,i,k,g),j.isFullyInitialized(),a.filter.filtersNodes())}}return h}function cb(a,b){return a.eventCache.isCompleteForChild(b)}function cc(a,b,c){return c.foreach((a,c)=>{b=b.updateChild(a,c)}),b}function cd(a,b,c,d,e,f,g,h){let i;if(b.serverCache.getNode().isEmpty()&&!b.serverCache.isFullyInitialized())return b;let j=b;i=aH(c)?d:new bL(null).setTree(c,d);let k=b.serverCache.getNode();return i.children.inorderTraversal((c,d)=>{if(k.hasChild(c)){let i=cc(a,b.serverCache.getNode().getImmediateChild(c),d);j=b9(a,j,new ay(c),i,e,f,g,h)}}),i.children.inorderTraversal((c,d)=>{let i=!b.serverCache.isCompleteForChild(c)&&null===d.value;if(!k.hasChild(c)&&!i){let i=cc(a,b.serverCache.getNode().getImmediateChild(c),d);j=b9(a,j,new ay(c),i,e,f,g,h)}}),j}class ce{constructor(a,b){this.query_=a,this.eventRegistrations_=[];let c=this.query_._queryParams,d=new bk(c.getIndex()),e=function(a){return a.loadsAllData()?new bk(a.getIndex()):a.hasLimit()?new bm(a):new bl(a)}(c);this.processor_={filter:e};let f=b.serverCache,g=b.eventCache,h=d.updateFullNode(a9.EMPTY_NODE,f.getNode(),null),i=e.updateFullNode(a9.EMPTY_NODE,g.getNode(),null),j=new bD(h,f.isFullyInitialized(),d.filtersNodes()),k=new bD(i,g.isFullyInitialized(),e.filtersNodes());this.viewCache_=bG(k,j),this.eventGenerator_=new bE(this.query_)}get query(){return this.query_}}function cf(a){return 0===a.eventRegistrations_.length}function cg(a,b,c){let d=[];if(c){(0,p.vA)(null==b,"A cancel should cancel all event registrations.");let e=a.query._path;a.eventRegistrations_.forEach(a=>{let b=a.createCancelEvent(c,e);b&&d.push(b)})}if(b){let c=[];for(let d=0;d<a.eventRegistrations_.length;++d){let e=a.eventRegistrations_[d];if(e.matches(b)){if(b.hasAnyCallback()){c=c.concat(a.eventRegistrations_.slice(d+1));break}}else c.push(e)}a.eventRegistrations_=c}else a.eventRegistrations_=[];return d}function ch(a,b,c,d){var e,f;b.type===n.MERGE&&null!==b.source.queryId&&((0,p.vA)(bK(a.viewCache_),"We should always have a full cache before handling merges"),(0,p.vA)(bJ(a.viewCache_),"Missing event cache, even though we have a server cache"));let g=a.viewCache_,h=function(a,b,c,d,e){let f,g,h=new b4;if(c.type===n.OVERWRITE)c.source.fromUser?f=ca(a,b,c.path,c.snap,d,e,h):((0,p.vA)(c.source.fromServer,"Unknown source."),g=c.source.tagged||b.serverCache.isFiltered()&&!aH(c.path),f=b9(a,b,c.path,c.snap,d,e,g,h));else if(c.type===n.MERGE){var i,j,k,l,m,o,q;let n;c.source.fromUser?(i=a,j=b,k=c.path,l=c.children,m=d,o=e,q=h,n=j,l.foreach((a,b)=>{let c=aG(k,a);cb(j,aA(c))&&(n=ca(i,n,c,b,m,o,q))}),l.foreach((a,b)=>{let c=aG(k,a);cb(j,aA(c))||(n=ca(i,n,c,b,m,o,q))}),f=n):((0,p.vA)(c.source.fromServer,"Unknown source."),g=c.source.tagged||b.serverCache.isFiltered(),f=cd(a,b,c.path,c.children,d,e,g,h))}else if(c.type===n.ACK_USER_WRITE)f=c.revert?function(a,b,c,d,e,f){let g;if(null!=b0(d,c))return b;{let h,i=new b7(d,b,e),j=b.eventCache.getNode();if(aH(c)||".priority"===aA(c)){let c;if(b.serverCache.isFullyInitialized())c=bZ(d,bK(b));else{let a=b.serverCache.getNode();(0,p.vA)(a instanceof a9,"serverChildren would be complete if leaf node"),c=b$(d,a)}h=a.filter.updateFullNode(j,c,f)}else{let e=aA(c),k=b1(d,e,b.serverCache);null==k&&b.serverCache.isCompleteForChild(e)&&(k=j.getImmediateChild(e)),(h=null!=k?a.filter.updateChild(j,e,k,aC(c),i,f):b.eventCache.getNode().hasChild(e)?a.filter.updateChild(j,e,a9.EMPTY_NODE,aC(c),i,f):j).isEmpty()&&b.serverCache.isFullyInitialized()&&(g=bZ(d,bK(b))).isLeafNode()&&(h=a.filter.updateFullNode(h,g,f))}return g=b.serverCache.isFullyInitialized()||null!=b0(d,az()),bH(b,h,g,a.filter.filtersNodes())}}(a,b,c.path,d,e,h):function(a,b,c,d,e,f,g){if(null!=b0(e,c))return b;let h=b.serverCache.isFiltered(),i=b.serverCache;if(null!=d.value)if(aH(c)&&i.isFullyInitialized()||i.isCompleteForPath(c))return b9(a,b,c,i.getNode().getChild(c),e,f,h,g);else{if(!aH(c))return b;let d=new bL(null);return i.getNode().forEachChild(aU,(a,b)=>{d=d.set(new ay(a),b)}),cd(a,b,c,d,e,f,h,g)}{let j=new bL(null);return d.foreach((a,b)=>{let d=aG(c,a);i.isCompleteForPath(d)&&(j=j.set(a,i.getNode().getChild(d)))}),cd(a,b,c,j,e,f,h,g)}}(a,b,c.path,c.affectedTree,d,e,h);else if(c.type===n.LISTEN_COMPLETE)f=function(a,b,c,d,e){let f=b.serverCache;return b8(a,bI(b,f.getNode(),f.isFullyInitialized()||aH(c),f.isFiltered()),c,d,b6,e)}(a,b,c.path,d,h);else throw(0,p.Hk)("Unknown operation type: "+c.type);let r=h.getChanges();return function(a,b,c){let d=b.eventCache;if(d.isFullyInitialized()){let e=d.getNode().isLeafNode()||d.getNode().isEmpty(),f=bJ(a);!(c.length>0)&&a.eventCache.isFullyInitialized()&&(!e||d.getNode().equals(f))&&d.getNode().getPriority().equals(f.getPriority())||c.push(bg(bJ(b)))}}(b,f,r),{viewCache:f,changes:r}}(a.processor_,g,b,c,d);return e=a.processor_,f=h.viewCache,(0,p.vA)(f.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),(0,p.vA)(f.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed"),(0,p.vA)(h.viewCache.serverCache.isFullyInitialized()||!g.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),a.viewCache_=h.viewCache,ci(a,h.changes,h.viewCache.eventCache.getNode(),null)}function ci(a,b,c,d){let e=d?[d]:a.eventRegistrations_;var f=a.eventGenerator_;let g=[],h=[];return b.forEach(a=>{var b;"child_changed"===a.type&&f.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&h.push((b=a.childName,{type:"child_moved",snapshotNode:a.snapshotNode,childName:b}))}),bF(f,g,"child_removed",b,e,c),bF(f,g,"child_added",b,e,c),bF(f,g,"child_moved",h,e,c),bF(f,g,"child_changed",b,e,c),bF(f,g,"value",b,e,c),g}class cj{constructor(){this.views=new Map}}function ck(a,b,c,d){let e=b.source.queryId;if(null!==e){let f=a.views.get(e);return(0,p.vA)(null!=f,"SyncTree gave us an op for an invalid query."),ch(f,b,c,d)}{let e=[];for(let f of a.views.values())e=e.concat(ch(f,b,c,d));return e}}function cl(a){let b=[];for(let c of a.views.values())c.query._queryParams.loadsAllData()||b.push(c);return b}function cm(a,b){let c=null;for(let d of a.views.values())c=c||function(a,b){let c=bK(a.viewCache_);return c&&(a.query._queryParams.loadsAllData()||!aH(b)&&!c.getImmediateChild(aA(b)).isEmpty())?c.getChild(b):null}(d,b);return c}function cn(a,b){if(b._queryParams.loadsAllData())return cp(a);{let c=b._queryIdentifier;return a.views.get(c)}}function co(a){return null!=cp(a)}function cp(a){for(let b of a.views.values())if(b.query._queryParams.loadsAllData())return b;return null}let cq=1;class cr{constructor(a){this.listenProvider_=a,this.syncPointTree_=new bL(null),this.pendingWriteTree_={visibleWrites:bM.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function cs(a,b,c,d,e){var f,g;return(f=a.pendingWriteTree_,g=e,(0,p.vA)(d>f.lastWriteId,"Stacking an older write on top of newer ones"),void 0===g&&(g=!0),f.allWrites.push({path:b,snap:c,writeId:d,visible:g}),g&&(f.visibleWrites=bN(f.visibleWrites,b,c)),f.lastWriteId=d,e)?cy(a,new bB(bw(),b,c)):[]}function ct(a,b,c=!1){let d=function(a,b){for(let c=0;c<a.allWrites.length;c++){let d=a.allWrites[c];if(d.writeId===b)return d}return null}(a.pendingWriteTree_,b);if(!function(a,b){var c;let d=a.allWrites.findIndex(a=>a.writeId===b);(0,p.vA)(d>=0,"removeWrite called with nonexistent writeId.");let e=a.allWrites[d];a.allWrites.splice(d,1);let f=e.visible,g=!1,h=a.allWrites.length-1;for(;f&&h>=0;){let b=a.allWrites[h];b.visible&&(h>=d&&function(a,b){if(a.snap)return aL(a.path,b);for(let c in a.children)if(a.children.hasOwnProperty(c)&&aL(aG(a.path,c),b))return!0;return!1}(b,e.path)?f=!1:aL(e.path,b.path)&&(g=!0)),h--}return!!f&&(g?((c=a).visibleWrites=bX(c.allWrites,bW,az()),c.allWrites.length>0?c.lastWriteId=c.allWrites[c.allWrites.length-1].writeId:c.lastWriteId=-1):e.snap?a.visibleWrites=bP(a.visibleWrites,e.path):X(e.children,b=>{a.visibleWrites=bP(a.visibleWrites,aG(e.path,b))}),!0)}(a.pendingWriteTree_,b))return[];{let b=new bL(null);return null!=d.snap?b=b.set(az(),!0):X(d.children,a=>{b=b.set(new ay(a),!0)}),cy(a,new bz(d.path,b,c))}}function cu(a,b,c){return cy(a,new bB(bx(),b,c))}function cv(a,b,c,d,e=!1){let f=b._path,g=a.syncPointTree_.get(f),h=[];if(g&&("default"===b._queryIdentifier||null!=cn(g,b))){let k=function(a,b,c,d){let e=b._queryIdentifier,f=[],g=[],h=co(a);if("default"===e)for(let[b,e]of a.views.entries())g=g.concat(cg(e,c,d)),cf(e)&&(a.views.delete(b),e.query._queryParams.loadsAllData()||f.push(e.query));else{let b=a.views.get(e);b&&(g=g.concat(cg(b,c,d)),cf(b)&&(a.views.delete(e),b.query._queryParams.loadsAllData()||f.push(b.query)))}return h&&!co(a)&&f.push(new((0,p.vA)(l,"Reference.ts has not been loaded"),l)(b._repo,b._path)),{removed:f,events:g}}(g,b,c,d);0===g.views.size&&(a.syncPointTree_=a.syncPointTree_.remove(f));let m=k.removed;if(h=k.events,!e){let c=-1!==m.findIndex(a=>a._queryParams.loadsAllData()),e=a.syncPointTree_.findOnPath(f,(a,b)=>co(b));if(c&&!e){let b=a.syncPointTree_.subtree(f);if(!b.isEmpty()){let c=b.fold((a,b,c)=>{if(b&&co(b))return[cp(b)];{let a=[];return b&&(a=cl(b)),X(c,(b,c)=>{a=a.concat(c)}),a}});for(let b=0;b<c.length;++b){let d=c[b],e=d.query,f=cz(a,d);a.listenProvider_.startListening(cF(e),cA(a,e),f.hashFn,f.onComplete)}}}e||!(m.length>0)||d||(c?a.listenProvider_.stopListening(cF(b),null):m.forEach(b=>{let c=a.queryToTagMap.get(cB(b));a.listenProvider_.stopListening(cF(b),c)}))}var i=a,j=m;for(let a=0;a<j.length;++a){let b=j[a];if(!b._queryParams.loadsAllData()){let a=cB(b),c=i.queryToTagMap.get(a);i.queryToTagMap.delete(a),i.tagToQueryMap.delete(c)}}}return h}function cw(a,b,c,d=!1){let e,f=b._path,g=null,h=!1;a.syncPointTree_.foreachOnPath(f,(a,b)=>{let c=aI(a,f);g=g||cm(b,c),h=h||co(b)});let i=a.syncPointTree_.get(f);i?(h=h||co(i),g=g||cm(i,az())):(i=new cj,a.syncPointTree_=a.syncPointTree_.set(f,i)),null!=g?e=!0:(e=!1,g=a9.EMPTY_NODE,a.syncPointTree_.subtree(f).foreachChild((a,b)=>{let c=cm(b,az());c&&(g=g.updateImmediateChild(a,c))}));let j=null!=cn(i,b);if(!j&&!b._queryParams.loadsAllData()){let c=cB(b);(0,p.vA)(!a.queryToTagMap.has(c),"View does not exist, but we have a tag");let d=cq++;a.queryToTagMap.set(c,d),a.tagToQueryMap.set(d,c)}let k=function(a,b,c,d,e,f){let g=function(a,b,c,d,e){let f=b._queryIdentifier,g=a.views.get(f);if(!g){let a=bZ(c,e?d:null),f=!1;return a?f=!0:(a=d instanceof a9?b$(c,d):a9.EMPTY_NODE,f=!1),new ce(b,bG(new bD(a,f,!1),new bD(d,e,!1)))}return g}(a,b,d,e,f);a.views.has(b._queryIdentifier)||a.views.set(b._queryIdentifier,g),g.eventRegistrations_.push(c);let h=g.viewCache_.eventCache,i=[];return h.getNode().isLeafNode()||h.getNode().forEachChild(a3,(a,b)=>{i.push(bh(a,b))}),h.isFullyInitialized()&&i.push(bg(h.getNode())),ci(g,i,h.getNode(),c)}(i,b,c,b3(f,a.pendingWriteTree_),g,e);if(!j&&!h&&!d){let c=cn(i,b);k=k.concat(function(a,b,c){let d=b._path,e=cA(a,b),f=cz(a,c),g=a.listenProvider_.startListening(cF(b),e,f.hashFn,f.onComplete),h=a.syncPointTree_.subtree(d);if(e)(0,p.vA)(!co(h.value),"If we're adding a query, it shouldn't be shadowed");else{let b=h.fold((a,b,c)=>{if(!aH(a)&&b&&co(b))return[cp(b).query];{let a=[];return b&&(a=a.concat(cl(b).map(a=>a.query))),X(c,(b,c)=>{a=a.concat(c)}),a}});for(let c=0;c<b.length;++c){let d=b[c];a.listenProvider_.stopListening(cF(d),cA(a,d))}}return g}(a,b,c))}return k}function cx(a,b,c){let d=a.pendingWriteTree_,e=a.syncPointTree_.findOnPath(b,(a,c)=>{let d=cm(c,aI(a,b));if(d)return d});return bY(d,b,e,c,!0)}function cy(a,b){var c;return function a(b,c,d,e){if(aH(b.path))return function a(b,c,d,e){let f=c.get(az());null==d&&null!=f&&(d=cm(f,az()));let g=[];return c.children.inorderTraversal((c,f)=>{let h=d?d.getImmediateChild(c):null,i=b2(e,c),j=b.operationForChild(c);j&&(g=g.concat(a(j,f,h,i)))}),f&&(g=g.concat(ck(f,b,e,d))),g}(b,c,d,e);{let f=c.get(az());null==d&&null!=f&&(d=cm(f,az()));let g=[],h=aA(b.path),i=b.operationForChild(h),j=c.children.get(h);if(j&&i){let b=d?d.getImmediateChild(h):null,c=b2(e,h);g=g.concat(a(i,j,b,c))}return f&&(g=g.concat(ck(f,b,e,d))),g}}(b,a.syncPointTree_,null,(c=a.pendingWriteTree_,b3(az(),c)))}function cz(a,b){let c=b.query,d=cA(a,c);return{hashFn:()=>(b.viewCache_.serverCache.getNode()||a9.EMPTY_NODE).hash(),onComplete:b=>{if("ok"===b)if(d)return function(a,b,c){let d=cC(a,c);if(!d)return[];{let c=cD(d),e=c.path,f=c.queryId,g=aI(e,b);return cE(a,e,new bA(by(f),g))}}(a,c._path,d);else{var e;return e=c._path,cy(a,new bA(bx(),e))}{let d=function(a,b){let c="Unknown Error";"too_big"===a?c="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===a?c="Client doesn't have permission to access the desired data.":"unavailable"===a&&(c="The service is unavailable");let d=Error(a+" at "+b._path.toString()+": "+c);return d.code=a.toUpperCase(),d}(b,c);return cv(a,c,null,d)}}}}function cA(a,b){let c=cB(b);return a.queryToTagMap.get(c)}function cB(a){return a._path.toString()+"$"+a._queryIdentifier}function cC(a,b){return a.tagToQueryMap.get(b)}function cD(a){let b=a.indexOf("$");return(0,p.vA)(-1!==b&&b<a.length-1,"Bad queryKey."),{queryId:a.substr(b+1),path:new ay(a.substr(0,b))}}function cE(a,b,c){let d=a.syncPointTree_.get(b);return(0,p.vA)(d,"Missing sync point for query tag that we're tracking"),ck(d,c,b3(b,a.pendingWriteTree_),null)}function cF(a){return a._queryParams.loadsAllData()&&!a._queryParams.isDefault()?new((0,p.vA)(m,"Reference.ts has not been loaded"),m)(a._repo,a._path):a}class cG{constructor(a){this.node_=a}getImmediateChild(a){return new cG(this.node_.getImmediateChild(a))}node(){return this.node_}}class cH{constructor(a,b){this.syncTree_=a,this.path_=b}getImmediateChild(a){let b=aG(this.path_,a);return new cH(this.syncTree_,b)}node(){return cx(this.syncTree_,this.path_)}}let cI=function(a,b,c){return a&&"object"==typeof a?((0,p.vA)(".sv"in a,"Unexpected leaf node or priority contents"),"string"==typeof a[".sv"])?cJ(a[".sv"],b,c):"object"==typeof a[".sv"]?cK(a[".sv"],b):void(0,p.vA)(!1,"Unexpected server value: "+JSON.stringify(a,null,2)):a},cJ=function(a,b,c){if("timestamp"===a)return c.timestamp;(0,p.vA)(!1,"Unexpected server value: "+a)},cK=function(a,b,c){a.hasOwnProperty("increment")||(0,p.vA)(!1,"Unexpected server value: "+JSON.stringify(a,null,2));let d=a.increment;"number"!=typeof d&&(0,p.vA)(!1,"Unexpected increment value: "+d);let e=b.node();if((0,p.vA)(null!=e,"Expected ChildrenNode.EMPTY_NODE for nulls"),!e.isLeafNode())return d;let f=e.getValue();return"number"!=typeof f?d:f+d},cL=function(a,b,c,d){return cN(b,new cH(c,a),d)},cM=function(a,b,c){return cN(a,new cG(b),c)};function cN(a,b,c){let d,e=cI(a.getPriority().val(),b.getImmediateChild(".priority"),c);if(!a.isLeafNode())return d=a,e!==a.getPriority().val()&&(d=d.updatePriority(new a1(e))),a.forEachChild(a3,(a,e)=>{let f=cN(e,b.getImmediateChild(a),c);f!==e&&(d=d.updateImmediateChild(a,f))}),d;{let d=cI(a.getValue(),b,c);return d!==a.getValue()||e!==a.getPriority().val()?new a1(d,bc(e)):a}}class cO{constructor(a="",b=null,c={children:{},childCount:0}){this.name=a,this.parent=b,this.node=c}}function cP(a,b){let c=b instanceof ay?b:new ay(b),d=a,e=aA(c);for(;null!==e;){let a=(0,p.yw)(d.node.children,e)||{children:{},childCount:0};d=new cO(e,d,a),e=aA(c=aC(c))}return d}function cQ(a){return a.node.value}function cR(a,b){a.node.value=b,function a(b){null!==b.parent&&function(b,c,d){let e=void 0===cQ(d)&&!cS(d),f=(0,p.gR)(b.node.children,c);e&&f?(delete b.node.children[c],b.node.childCount--,a(b)):e||f||(b.node.children[c]=d.node,b.node.childCount++,a(b))}(b.parent,b.name,b)}(a)}function cS(a){return a.node.childCount>0}function cT(a,b){X(a.node.children,(c,d)=>{b(new cO(c,a,d))})}function cU(a){return new ay(null===a.parent?a.name:cU(a.parent)+"/"+a.name)}let cV=/[\[\].#$\/\u0000-\u001F\u007F]/,cW=/[\[\].#$\u0000-\u001F\u007F]/,cX=function(a){return"string"==typeof a&&0!==a.length&&!cV.test(a)},cY=function(a){return"string"==typeof a&&0!==a.length&&!cW.test(a)},cZ=function(a,b,c,d){d&&void 0===b||c$((0,p.dI)(a,"value"),b,c)},c$=function(a,b,c){let d=c instanceof ay?new aM(c,a):c;if(void 0===b)throw Error(a+"contains undefined "+aO(d));if("function"==typeof b)throw Error(a+"contains a function "+aO(d)+" with contents = "+b.toString());if(O(b))throw Error(a+"contains "+b.toString()+" "+aO(d));if("string"==typeof b&&b.length>3495253.3333333335&&(0,p.OE)(b)>0xa00000)throw Error(a+"contains a string greater than 10485760 utf8 bytes "+aO(d)+" ('"+b.substring(0,50)+"...')");if(b&&"object"==typeof b){let c=!1,e=!1;if(X(b,(b,f)=>{if(".value"===b)c=!0;else if(".priority"!==b&&".sv"!==b&&(e=!0,!cX(b)))throw Error(a+" contains an invalid key ("+b+") "+aO(d)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');d.parts_.length>0&&(d.byteLength_+=1),d.parts_.push(b),d.byteLength_+=(0,p.OE)(b),aN(d),c$(a,f,d);let g=d.parts_.pop();d.byteLength_-=(0,p.OE)(g),d.parts_.length>0&&(d.byteLength_-=1)}),c&&e)throw Error(a+' contains ".value" child '+aO(d)+" in addition to actual children.")}},c_=function(a,b){let c,d;for(c=0;c<b.length;c++){let e=aE(d=b[c]);for(let b=0;b<e.length;b++)if(".priority"===e[b]&&b===e.length-1);else if(!cX(e[b]))throw Error(a+"contains an invalid key ("+e[b]+") in path "+d.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}b.sort(aJ);let e=null;for(c=0;c<b.length;c++){if(d=b[c],null!==e&&aL(e,d))throw Error(a+"contains a path "+e.toString()+" that is ancestor of another path "+d.toString());e=d}},c0=function(a,b,c,d){if(d&&void 0===b)return;let e=(0,p.dI)(a,"values");if(!(b&&"object"==typeof b)||Array.isArray(b))throw Error(e+" must be an object containing the children to replace.");let f=[];X(b,(a,b)=>{let d=new ay(a);if(c$(e,b,aG(c,d)),".priority"===aD(d)&&!(null===b||"string"==typeof b||"number"==typeof b&&!O(b)||b&&"object"==typeof b&&(0,p.gR)(b,".sv")))throw Error(e+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");f.push(d)}),c_(e,f)},c1=function(a,b,c,d){if((!d||void 0!==c)&&!cY(c))throw Error((0,p.dI)(a,b)+'was an invalid path = "'+c+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},c2=function(a,b,c,d){c&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),c1(a,b,c,d)},c3=function(a,b){if(".info"===aA(b))throw Error(a+" failed = Can't modify data under /.info/")},c4=function(a,b){var c;let d=b.path.toString();if("string"!=typeof b.repoInfo.host||0===b.repoInfo.host.length||!cX(b.repoInfo.namespace)&&"localhost"!==b.repoInfo.host.split(":")[0]||0!==d.length&&((c=d)&&(c=c.replace(/^\/*\.info(\/|$)/,"/")),!cY(c)))throw Error((0,p.dI)(a,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class c5{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function c6(a,b){let c=null;for(let d=0;d<b.length;d++){let e=b[d],f=e.getPath();null===c||aK(f,c.path)||(a.eventLists_.push(c),c=null),null===c&&(c={events:[],path:f}),c.events.push(e)}c&&a.eventLists_.push(c)}function c7(a,b,c){c6(a,c),c9(a,a=>aK(a,b))}function c8(a,b,c){c6(a,c),c9(a,a=>aL(a,b)||aL(b,a))}function c9(a,b){a.recursionDepth_++;let c=!0;for(let d=0;d<a.eventLists_.length;d++){let e=a.eventLists_[d];e&&(b(e.path)?(function(a){for(let b=0;b<a.events.length;b++){let c=a.events[b];if(null!==c){a.events[b]=null;let d=c.getEventRunner();F&&I("event: "+c.toString()),_(d)}}}(a.eventLists_[d]),a.eventLists_[d]=null):c=!1)}c&&(a.eventLists_=[]),a.recursionDepth_--}class da{constructor(a,b,c,d){this.repoInfo_=a,this.forceRestClient_=b,this.authTokenProvider_=c,this.appCheckProvider_=d,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new c5,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=bs(),this.transactionQueueTree_=new cO,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function db(a){let b=a.infoData_.getNode(new ay(".info/serverTimeOffset")).val()||0;return new Date().getTime()+b}function dc(a){var b;return(b=b={timestamp:db(a)}).timestamp=b.timestamp||new Date().getTime(),b}function dd(a,b,c,d,e){a.dataUpdateCount++;let f=new ay(b);c=a.interceptServerDataCallback_?a.interceptServerDataCallback_(b,c):c;let g=[];if(e)if(d){let b=(0,p.kH)(c,a=>bc(a));g=function(a,b,c,d){let e=cC(a,d);if(!e)return[];{let d=cD(e),f=d.path,g=d.queryId,h=aI(f,b),i=bL.fromObject(c);return cE(a,f,new bC(by(g),h,i))}}(a.serverSyncTree_,f,b,e)}else{let b=bc(c);g=function(a,b,c,d){let e=cC(a,d);if(null==e)return[];{let d=cD(e),f=d.path,g=d.queryId,h=aI(f,b);return cE(a,f,new bB(by(g),h,c))}}(a.serverSyncTree_,f,b,e)}else if(d){let b=(0,p.kH)(c,a=>bc(a));g=function(a,b,c){let d=bL.fromObject(c);return cy(a,new bC(bx(),b,d))}(a.serverSyncTree_,f,b)}else{let b=bc(c);g=cu(a.serverSyncTree_,f,b)}let h=f;g.length>0&&(h=dl(a,f)),c8(a.eventQueue_,h,g)}function de(a,b){df(a,"connected",b),!1===b&&function(a){di(a,"onDisconnectEvents");let b=dc(a),c=bs();bt(a.onDisconnect_,az(),(d,e)=>{let f=cL(d,e,a.serverSyncTree_,b);!function a(b,c,d){if(aH(c))b.value=d,b.children.clear();else if(null!==b.value)b.value=b.value.updateChild(c,d);else{let e=aA(c);b.children.has(e)||b.children.set(e,bs()),a(b.children.get(e),c=aC(c),d)}}(c,d,f)});let d=[];bt(c,az(),(b,c)=>{d=d.concat(cu(a.serverSyncTree_,b,c));let e=dq(a,b);dl(a,e)}),a.onDisconnect_=bs(),c8(a.eventQueue_,az(),d)}(a)}function df(a,b,c){let d=new ay("/.info/"+b),e=bc(c);a.infoData_.updateSnapshot(d,e);let f=cu(a.infoSyncTree_,d,e);c8(a.eventQueue_,d,f)}function dg(a){return a.nextWriteId_++}function dh(a,b,c){let d;d=".info"===aA(b._path)?cv(a.infoSyncTree_,b,c):cv(a.serverSyncTree_,b,c),c7(a.eventQueue_,b._path,d)}function di(a,...b){let c="";a.persistentConnection_&&(c=a.persistentConnection_.id+":"),I(c,...b)}function dj(a,b,c,d){b&&_(()=>{if("ok"===c)b(null);else{let a=(c||"error").toUpperCase(),e=a;d&&(e+=": "+d);let f=Error(e);f.code=a,b(f)}})}function dk(a,b,c){return cx(a.serverSyncTree_,b,c)||a9.EMPTY_NODE}function dl(a,b){let c=dm(a,b),d=cU(c),e=dn(a,c);return function(a,b,c){if(0===b.length)return;let d=[],e=[],f=b.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let g=0;g<b.length;g++){let h=b[g],i=aI(c,h.path),j=!1,k;if((0,p.vA)(null!==i,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)j=!0,k=h.abortReason,e=e.concat(ct(a.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=25)j=!0,k="maxretry",e=e.concat(ct(a.serverSyncTree_,h.currentWriteId,!0));else{let c=dk(a,h.path,f);h.currentInputSnapshot=c;let d=b[g].update(c.val());if(void 0!==d){c$("transaction failed: Data returned ",d,h.path);let b=bc(d);"object"==typeof d&&null!=d&&(0,p.gR)(d,".priority")||(b=b.updatePriority(c.getPriority()));let g=h.currentWriteId,i=cM(b,c,dc(a));h.currentOutputSnapshotRaw=b,h.currentOutputSnapshotResolved=i,h.currentWriteId=dg(a),f.splice(f.indexOf(g),1),e=(e=e.concat(cs(a.serverSyncTree_,h.path,i,h.currentWriteId,h.applyLocally))).concat(ct(a.serverSyncTree_,g,!0))}else j=!0,k="nodata",e=e.concat(ct(a.serverSyncTree_,h.currentWriteId,!0))}c8(a.eventQueue_,c,e),e=[],j&&(b[g].status=2,setTimeout(b[g].unwatcher,Math.floor(0)),b[g].onComplete&&("nodata"===k?d.push(()=>b[g].onComplete(null,!1,b[g].currentInputSnapshot)):d.push(()=>b[g].onComplete(Error(k),!1,null))))}dp(a,a.transactionQueueTree_);for(let a=0;a<d.length;a++)_(d[a]);!function a(b,c=b.transactionQueueTree_){if(c||dp(b,c),cQ(c)){let d=dn(b,c);(0,p.vA)(d.length>0,"Sending zero length transaction queue"),d.every(a=>0===a.status)&&function(b,c,d){let e=dk(b,c,d.map(a=>a.currentWriteId)),f=e,g=e.hash();for(let a=0;a<d.length;a++){let b=d[a];(0,p.vA)(0===b.status,"tryToSendTransactionQueue_: items in queue should all be run."),b.status=1,b.retryCount++;let e=aI(c,b.path);f=f.updateChild(e,b.currentOutputSnapshotRaw)}let h=f.val(!0);b.server_.put(c.toString(),h,e=>{di(b,"transaction put response",{path:c.toString(),status:e});let f=[];if("ok"===e){let e=[];for(let a=0;a<d.length;a++)d[a].status=2,f=f.concat(ct(b.serverSyncTree_,d[a].currentWriteId)),d[a].onComplete&&e.push(()=>d[a].onComplete(null,!0,d[a].currentOutputSnapshotResolved)),d[a].unwatcher();dp(b,cP(b.transactionQueueTree_,c)),a(b,b.transactionQueueTree_),c8(b.eventQueue_,c,f);for(let a=0;a<e.length;a++)_(e[a])}else{if("datastale"===e)for(let a=0;a<d.length;a++)3===d[a].status?d[a].status=4:d[a].status=0;else{M("transaction at "+c.toString()+" failed: "+e);for(let a=0;a<d.length;a++)d[a].status=4,d[a].abortReason=e}dl(b,c)}},g)}(b,cU(c),d)}else cS(c)&&cT(c,c=>{a(b,c)})}(a,a.transactionQueueTree_)}(a,e,d),d}function dm(a,b){let c,d=a.transactionQueueTree_;for(c=aA(b);null!==c&&void 0===cQ(d);)d=cP(d,c),c=aA(b=aC(b));return d}function dn(a,b){let c=[];return function a(b,c,d){let e=cQ(c);if(e)for(let a=0;a<e.length;a++)d.push(e[a]);cT(c,c=>{a(b,c,d)})}(a,b,c),c.sort((a,b)=>a.order-b.order),c}function dp(a,b){let c=cQ(b);if(c){let a=0;for(let b=0;b<c.length;b++)2!==c[b].status&&(c[a]=c[b],a++);c.length=a,cR(b,c.length>0?c:void 0)}cT(b,b=>{dp(a,b)})}function dq(a,b){let c=cU(dm(a,b)),d=cP(a.transactionQueueTree_,b);return!function(a,b,c){let d=a.parent;for(;null!==d;){if(b(d))return!0;d=d.parent}}(d,b=>{dr(a,b)}),dr(a,d),!function a(b,c,d,e){d&&!e&&c(b),cT(b,b=>{a(b,c,!0,e)}),d&&e&&c(b)}(d,b=>{dr(a,b)}),c}function dr(a,b){let c=cQ(b);if(c){let d=[],e=[],f=-1;for(let b=0;b<c.length;b++)3===c[b].status||(1===c[b].status?((0,p.vA)(f===b-1,"All SENT items should be at beginning of queue."),f=b,c[b].status=3,c[b].abortReason="set"):((0,p.vA)(0===c[b].status,"Unexpected transaction status in abort"),c[b].unwatcher(),e=e.concat(ct(a.serverSyncTree_,c[b].currentWriteId,!0)),c[b].onComplete&&d.push(c[b].onComplete.bind(null,Error("set"),!1,null))));-1===f?cR(b,void 0):c.length=f+1,c8(a.eventQueue_,cU(b),e);for(let a=0;a<d.length;a++)_(d[a])}}let ds=function(a,b){let c=dt(a),d=c.namespace;"firebase.com"===c.domain&&L(c.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),d&&"undefined"!==d||"localhost"===c.domain||L("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),c.secure||N();let e="ws"===c.scheme||"wss"===c.scheme;return{repoInfo:new ab(c.host,c.secure,d,e,b,"",d!==c.subdomain),path:new ay(c.pathString)}},dt=function(a){let b="",c="",d="",e="",f="",g=!0,h="https",i=443;if("string"==typeof a){let j=a.indexOf("//");j>=0&&(h=a.substring(0,j-1),a=a.substring(j+2));let k=a.indexOf("/");-1===k&&(k=a.length);let l=a.indexOf("?");-1===l&&(l=a.length),b=a.substring(0,Math.min(k,l)),k<l&&(e=function(a){let b="",c=a.split("/");for(let a=0;a<c.length;a++)if(c[a].length>0){let d=c[a];try{d=decodeURIComponent(d.replace(/\+/g," "))}catch(a){}b+="/"+d}return b}(a.substring(k,l)));let m=function(a){let b={};for(let c of("?"===a.charAt(0)&&(a=a.substring(1)),a.split("&"))){if(0===c.length)continue;let d=c.split("=");2===d.length?b[decodeURIComponent(d[0])]=decodeURIComponent(d[1]):M(`Invalid query segment '${c}' in query '${a}'`)}return b}(a.substring(Math.min(a.length,l)));(j=b.indexOf(":"))>=0?(g="https"===h||"wss"===h,i=parseInt(b.substring(j+1),10)):j=b.length;let n=b.slice(0,j);if("localhost"===n.toLowerCase())c="localhost";else if(n.split(".").length<=2)c=n;else{let a=b.indexOf(".");d=b.substring(0,a).toLowerCase(),c=b.substring(a+1),f=d}"ns"in m&&(f=m.ns)}return{host:b,port:i,domain:c,subdomain:d,secure:g,scheme:h,pathString:e,namespace:f}},du="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",dv=function(){let a=0,b=[];return function(c){let d,e=c===a;a=c;let f=Array(8);for(d=7;d>=0;d--)f[d]=du.charAt(c%64),c=Math.floor(c/64);(0,p.vA)(0===c,"Cannot push at time == 0");let g=f.join("");if(e){for(d=11;d>=0&&63===b[d];d--)b[d]=0;b[d]++}else for(d=0;d<12;d++)b[d]=Math.floor(64*Math.random());for(d=0;d<12;d++)g+=du.charAt(b[d]);return(0,p.vA)(20===g.length,"nextPushId: Length should be 20."),g}}();class dw{constructor(a,b,c,d){this.eventType=a,this.eventRegistration=b,this.snapshot=c,this.prevName=d}getPath(){let a=this.snapshot.ref;return"value"===this.eventType?a._path:a.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,p.As)(this.snapshot.exportVal())}}class dx{constructor(a,b,c){this.eventRegistration=a,this.error=b,this.path=c}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class dy{constructor(a,b){this.snapshotCallback=a,this.cancelCallback=b}onValue(a,b){this.snapshotCallback.call(null,a,b)}onCancel(a){return(0,p.vA)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,a)}get hasCancelCallback(){return!!this.cancelCallback}matches(a){return this.snapshotCallback===a.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===a.snapshotCallback.userCallback&&this.snapshotCallback.context===a.snapshotCallback.context}}class dz{constructor(a,b,c,d){this._repo=a,this._path=b,this._queryParams=c,this._orderByCalled=d}get key(){return aH(this._path)?null:aD(this._path)}get ref(){return new dA(this._repo,this._path)}get _queryIdentifier(){let a=V(bp(this._queryParams));return"{}"===a?"default":a}get _queryObject(){return bp(this._queryParams)}isEqual(a){if(!((a=(0,p.Ku)(a))instanceof dz))return!1;let b=this._repo===a._repo,c=aK(this._path,a._path),d=this._queryIdentifier===a._queryIdentifier;return b&&c&&d}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(a){let b="";for(let c=a.pieceNum_;c<a.pieces_.length;c++)""!==a.pieces_[c]&&(b+="/"+encodeURIComponent(String(a.pieces_[c])));return b||"/"}(this._path)}}class dA extends dz{constructor(a,b){super(a,b,new bn,!1)}get parent(){let a=aF(this._path);return null===a?null:new dA(this._repo,a)}get root(){let a=this;for(;null!==a.parent;)a=a.parent;return a}}class dB{constructor(a,b,c){this._node=a,this.ref=b,this._index=c}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(a){let b=new ay(a),c=dD(this.ref,a);return new dB(this._node.getChild(b),c,a3)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(a){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(b,c)=>a(new dB(c,dD(this.ref,b),a3)))}hasChild(a){let b=new ay(a);return!this._node.getChild(b).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function dC(a,b){return(a=(0,p.Ku)(a))._checkNotDeleted("ref"),void 0!==b?dD(a._root,b):a._root}function dD(a,b){return null===aA((a=(0,p.Ku)(a))._path)?c2("child","path",b,!1):c1("child","path",b,!1),new dA(a._repo,aG(a._path,b))}function dE(a,b){let c;c3("push",(a=(0,p.Ku)(a))._path),cZ("push",b,a._path,!0);let d=dv(db(a._repo)),e=dD(a,d),f=dD(a,d);return e.then=(c=null!=b?dG(f,b).then(()=>f):Promise.resolve(f)).then.bind(c),e.catch=c.then.bind(c,void 0),e}function dF(a){return c3("remove",a._path),dG(a,null)}function dG(a,b){c3("set",(a=(0,p.Ku)(a))._path),cZ("set",b,a._path,!1);let c=new p.cY;return!function(a,b,c,d,e){di(a,"set",{path:b.toString(),value:c,priority:null});let f=dc(a),g=bc(c,null),h=cM(g,cx(a.serverSyncTree_,b),f),i=dg(a),j=cs(a.serverSyncTree_,b,h,i,!0);c6(a.eventQueue_,j),a.server_.put(b.toString(),g.val(!0),(c,d)=>{let f="ok"===c;f||M("set at "+b+" failed: "+c);let g=ct(a.serverSyncTree_,i,!f);c8(a.eventQueue_,b,g),dj(a,e,c,d)});let k=dq(a,b);dl(a,k),c8(a.eventQueue_,k,[])}(a._repo,a._path,b,null,c.wrapCallback(()=>{})),c.promise}function dH(a,b){c0("update",b,a._path,!1);let c=new p.cY;return!function(a,b,c,d){di(a,"update",{path:b.toString(),value:c});let e=!0,f=dc(a),g={};if(X(c,(c,d)=>{e=!1,g[c]=cL(aG(b,c),bc(d),a.serverSyncTree_,f)}),e)I("update() called with empty data.  Don't do anything."),dj(a,d,"ok",void 0);else{let e=dg(a),f=function(a,b,c,d){var e;e=a.pendingWriteTree_,(0,p.vA)(d>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:b,children:c,writeId:d,visible:!0}),e.visibleWrites=bO(e.visibleWrites,b,c),e.lastWriteId=d;let f=bL.fromObject(c);return cy(a,new bC(bw(),b,f))}(a.serverSyncTree_,b,g,e);c6(a.eventQueue_,f),a.server_.merge(b.toString(),c,(c,f)=>{let g="ok"===c;g||M("update at "+b+" failed: "+c);let h=ct(a.serverSyncTree_,e,!g),i=h.length>0?dl(a,b):b;c8(a.eventQueue_,i,h),dj(a,d,c,f)}),X(c,c=>{let d=dq(a,aG(b,c));dl(a,d)}),c8(a.eventQueue_,b,[])}}(a._repo,a._path,b,c.wrapCallback(()=>{})),c.promise}class dI{constructor(a){this.callbackContext=a}respondsTo(a){return"value"===a}createEvent(a,b){let c=b._queryParams.getIndex();return new dw("value",this,new dB(a.snapshotNode,new dA(b._repo,b._path),c))}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,null)}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new dx(this,a,b):null}matches(a){return a instanceof dI&&(!a.callbackContext||!this.callbackContext||a.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class dJ{constructor(a,b){this.eventType=a,this.callbackContext=b}respondsTo(a){let b="children_added"===a?"child_added":a;return b="children_removed"===b?"child_removed":b,this.eventType===b}createCancelEvent(a,b){return this.callbackContext.hasCancelCallback?new dx(this,a,b):null}createEvent(a,b){(0,p.vA)(null!=a.childName,"Child events should have a childName.");let c=dD(new dA(b._repo,b._path),a.childName),d=b._queryParams.getIndex();return new dw(a.type,this,new dB(a.snapshotNode,c,d),a.prevName)}getEventRunner(a){return"cancel"===a.getEventType()?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,a.prevName)}matches(a){return a instanceof dJ&&this.eventType===a.eventType&&(!this.callbackContext||!a.callbackContext||this.callbackContext.matches(a.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function dK(a,b,c,d){return function(a,b,c,d,e){var f;let g,h;if("object"==typeof d&&(g=void 0,e=d),"function"==typeof d&&(g=d),e&&e.onlyOnce){let b=c,d=(c,d)=>{dh(a._repo,a,j),b(c,d)};d.userCallback=c.userCallback,d.context=c.context,c=d}let i=new dy(c,g||void 0),j="value"===b?new dI(i):new dJ(b,i);return f=a._repo,h=".info"===aA(a._path)?cw(f.infoSyncTree_,a,j):cw(f.serverSyncTree_,a,j),c7(f.eventQueue_,a._path,h),()=>dh(a._repo,a,j)}(a,"value",b,c,d)}(0,p.vA)(!l,"__referenceConstructor has already been defined"),l=dA,(0,p.vA)(!m,"__referenceConstructor has already been defined"),m=dA;let dL={};class dM{constructor(a,b){this._repoInternal=a,this.app=b,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(a,b,c){if(a.stats_=ag(a.repoInfo_),a.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)a.server_=new bq(a.repoInfo_,(b,c,d,e)=>{dd(a,b,c,d,e)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>de(a,!0),0);else{if(null!=c){if("object"!=typeof c)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,p.As)(c)}catch(a){throw Error("Invalid authOverride provided: "+a)}}a.persistentConnection_=new aQ(a.repoInfo_,b,(b,c,d,e)=>{dd(a,b,c,d,e)},b=>{de(a,b)},b=>{var c;c=a,X(b,(a,b)=>{df(c,a,b)})},a.authTokenProvider_,a.appCheckProvider_,c),a.server_=a.persistentConnection_}a.authTokenProvider_.addTokenChangeListener(b=>{a.server_.refreshAuthToken(b)}),a.appCheckProvider_.addTokenChangeListener(b=>{a.server_.refreshAppCheckToken(b.token)}),a.statsReporter_=function(a,b){let c=a.toString();return af[c]||(af[c]=b()),af[c]}(a.repoInfo_,()=>new bv(a.stats_,a.server_)),a.infoData_=new br,a.infoSyncTree_=new cr({startListening:(b,c,d,e)=>{let f=[],g=a.infoData_.getNode(b._path);return g.isEmpty()||(f=cu(a.infoSyncTree_,b._path,g),setTimeout(()=>{e("ok")},0)),f},stopListening:()=>{}}),df(a,"connected",!1),a.serverSyncTree_=new cr({startListening:(b,c,d,e)=>(a.server_.listen(b,d,c,(c,d)=>{let f=e(c,d);c8(a.eventQueue_,b._path,f)}),[]),stopListening:(b,c)=>{a.server_.unlisten(b,c)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new dA(this._repo,az())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(a,b){let c=dL[b];c&&c[a.key]===a||L(`Database ${b}(${a.repoInfo_}) has already been deleted.`),a.persistentConnection_&&a.persistentConnection_.interrupt("repo_interrupt"),delete c[a.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(a){null===this._rootInternal&&L("Cannot call "+a+" on a deleted database.")}}function dN(a=(0,r.Sx)(),b){let c=(0,r.j6)(a,"database").getImmediate({identifier:b});if(!c._instanceStarted){let a=(0,p.yU)("database");a&&function(a,b,c,d={}){let e;(a=(0,p.Ku)(a))._checkNotDeleted("useEmulator");let f=`${b}:${c}`,g=a._repoInternal;if(a._instanceStarted){if(f===a._repoInternal.repoInfo_.host&&(0,p.bD)(d,g.repoInfo_.emulatorOptions))return;L("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}g.repoInfo_.nodeAdmin?(d.mockUserToken&&L('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),e=new ao(ao.OWNER)):d.mockUserToken&&(e=new ao("string"==typeof d.mockUserToken?d.mockUserToken:(0,p.Fy)(d.mockUserToken,a.app.options.projectId))),(0,p.zJ)(b)&&((0,p.gE)(b),(0,p.P1)("Database",!0));var h=e;let i=f.lastIndexOf(":"),j=f.substring(0,i);g.repoInfo_=new ab(f,(0,p.zJ)(j),g.repoInfo_.namespace,g.repoInfo_.webSocketOnly,g.repoInfo_.nodeAdmin,g.repoInfo_.persistenceKey,g.repoInfo_.includeNamespaceInQueryParams,!0,d),h&&(g.authTokenProvider_=h)}(c,...a)}return c}aQ.prototype.simpleListen=function(a,b){this.sendRequest("q",{p:a},b)},aQ.prototype.echo=function(a,b){this.sendRequest("echo",{d:a},b)},ai=o.Client;ah=r.MF,(0,r.om)(new s.uA("database",(a,{instanceIdentifier:b})=>{let c=a.getProvider("app").getImmediate();return function(a,b,c,d,e){var f,g,h,i;let j,k,l,m,n=d||a.options.databaseURL;void 0===n&&(a.options.projectId||L("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),I("Using default host for project ",a.options.projectId),n=`${a.options.projectId}-default-rtdb.firebaseio.com`);let o=ds(n,void 0),p=o.repoInfo;"undefined"!=typeof process&&process.env&&(l=process.env.FIREBASE_DATABASE_EMULATOR_HOST),l?(m=!0,p=(o=ds(n=`http://${l}?ns=${p.namespace}`,void 0)).repoInfo):m=!o.repoInfo.secure;let q=e&&m?new ao(ao.OWNER):new an(a.name,a.options,b);return c4("Invalid Firebase Database URL",o),aH(o.path)||L("Database URL must point to the root of a Firebase Database (not including a child path)."),new dM((f=p,g=a,h=q,i=new am(a,c),(j=dL[g.name])||(j={},dL[g.name]=j),(k=j[f.toURLString()])&&L("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),k=new da(f,!1,h,i),j[f.toURLString()]=k,k),a)}(c,a.getProvider("auth-internal"),a.getProvider("app-check-internal"),b)},"PUBLIC").setMultipleInstances(!0)),(0,r.KO)(ak,al,"node"),(0,r.KO)(ak,al,"esm2017")},77335:(a,b,c)=>{"use strict";var d=c(62466),e=c(33412),f=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};f.MESSAGE_OPCODES=[1,2];var g={add:function(a){if("string"!=typeof a.name)throw TypeError("extension.name must be a string");if("permessage"!==a.type)throw TypeError('extension.type must be "permessage"');if("boolean"!=typeof a.rsv1)throw TypeError("extension.rsv1 must be true or false");if("boolean"!=typeof a.rsv2)throw TypeError("extension.rsv2 must be true or false");if("boolean"!=typeof a.rsv3)throw TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(a.name))throw TypeError('An extension with name "'+a.name+'" is already registered');this._byName[a.name]=a,this._inOrder.push(a)},generateOffer:function(){var a=[],b=[],c={};return this._inOrder.forEach(function(e){var f=e.createClientSession();if(f){var g=[e,f];a.push(g),c[e.name]=g;var h=f.generateOffer();(h=h?[].concat(h):[]).forEach(function(a){b.push(d.serializeParams(e.name,a))},this)}},this),this._sessions=a,this._index=c,b.length>0?b.join(", "):null},activate:function(a){var b=d.parseHeader(a),c=[];b.eachOffer(function(a,b){var e=this._index[a];if(!e)throw Error('Server sent an extension response for unknown extension "'+a+'"');var f=e[0],g=e[1],h=this._reserved(f);if(h)throw Error("Server sent two extension responses that use the RSV"+h[0]+' bit: "'+h[1]+'" and "'+f.name+'"');if(!0!==g.activate(b))throw Error("Server sent unacceptable extension parameters: "+d.serializeParams(a,b));this._reserve(f),c.push(e)},this),this._sessions=c,this._pipeline=new e(c)},generateResponse:function(a){var b=[],c=[],f=d.parseHeader(a);return this._inOrder.forEach(function(a){var e=f.byName(a.name);if(!(0===e.length||this._reserved(a))){var g=a.createServerSession(e);g&&(this._reserve(a),b.push([a,g]),c.push(d.serializeParams(a.name,g.generateResponse())))}},this),this._sessions=b,this._pipeline=new e(b),c.length>0?c.join(", "):null},validFrameRsv:function(a){var b,c={rsv1:!1,rsv2:!1,rsv3:!1};if(f.MESSAGE_OPCODES.indexOf(a.opcode)>=0)for(var d=0,e=this._sessions.length;d<e;d++)b=this._sessions[d][0],c.rsv1=c.rsv1||b.rsv1,c.rsv2=c.rsv2||b.rsv2,c.rsv3=c.rsv3||b.rsv3;return(c.rsv1||!a.rsv1)&&(c.rsv2||!a.rsv2)&&(c.rsv3||!a.rsv3)},processIncomingMessage:function(a,b,c){this._pipeline.processIncomingMessage(a,b,c)},processOutgoingMessage:function(a,b,c){this._pipeline.processOutgoingMessage(a,b,c)},close:function(a,b){if(!this._pipeline)return a.call(b);this._pipeline.close(a,b)},_reserve:function(a){this._rsv1=this._rsv1||a.rsv1&&a.name,this._rsv2=this._rsv2||a.rsv2&&a.name,this._rsv3=this._rsv3||a.rsv3&&a.name},_reserved:function(a){return this._rsv1&&a.rsv1?[1,this._rsv1]:this._rsv2&&a.rsv2?[2,this._rsv2]:!!this._rsv3&&!!a.rsv3&&[3,this._rsv3]}};for(var h in g)f.prototype[h]=g[h];a.exports=f},78829:(a,b,c)=>{"use strict";var d=c(50501);a.exports={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(a,b,c){this.on(a,b)},removeEventListener:function(a,b,c){this.removeListener(a,b)},dispatchEvent:function(a){a.target=a.currentTarget=this,a.eventPhase=d.AT_TARGET,this["on"+a.type]&&this["on"+a.type](a),this.emit(a.type,a)}}},93867:(a,b,c)=>{"use strict";var d=c(62253).Buffer,e=c(28647),f=c(28354),g=function(a,b,c){e.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};f.inherits(g,e);var h={close:function(){return 3!==this.readyState&&(this.readyState=3,this.emit("close",new e.CloseEvent(null,null)),!0)},parse:function(a){this.readyState>1||(this._reader.put(a),this._reader.eachByte(function(a){var b;switch(this._stage){case -1:this._body.push(a),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(a);break;case 1:if(this._length=(127&a)+128*this._length,this._closing&&0===this._length)return this.close();(128&a)!=128&&(0===this._length?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(255===a)this._stage=0,b=d.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new e.MessageEvent(b));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(a),this._buffer.length>this._maxLength)return this.close()}},this))},frame:function(a){if(0===this.readyState)return this._queue([a]);if(this.readyState>1)return!1;"string"!=typeof a&&(a=a.toString());var b=d.byteLength(a),c=d.allocUnsafe(b+2);return c[0]=0,c.write(a,1),c[c.length-1]=255,this._write(c),!0},_handshakeResponse:function(){var a=["HTTP/1.1 101 Web Socket Protocol Handshake",this._headers.toString(),""];return d.from(a.join("\r\n"),"utf8")},_parseLeadingByte:function(a){(128&a)==128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(var i in h)g.prototype[i]=h[i];a.exports=g},94519:(a,b,c)=>{"use strict";var d=c(28647),e=c(40485),f=c(72153);a.exports={client:function(a,b){return void 0===(b=b||{}).masking&&(b.masking=!0),new e(a,b)},server:function(a){return void 0===(a=a||{}).requireMasking&&(a.requireMasking=!0),new f(a)},http:function(){return f.http.apply(f,arguments)},isSecureRequest:function(a){return f.isSecureRequest(a)},isWebSocket:function(a){return d.isWebSocket(a)},validateOptions:function(a,b){d.validateOptions(a,b)}}},95599:(a,b,c)=>{"use strict";var d=c(4717),e=function(){this._complete=!1,this._callbacks=new d(e.QUEUE_SIZE)};e.QUEUE_SIZE=4,e.all=function(a){var b=new e,c=a.length,d=c;for(0===c&&b.done();d--;)a[d].then(function(){0==(c-=1)&&b.done()});return b},e.prototype.then=function(a){this._complete?a():this._callbacks.push(a)},e.prototype.done=function(){this._complete=!0;for(var a,b=this._callbacks;a=b.shift();)a()},a.exports=e},99826:(a,b,c)=>{"use strict";var d=c(27910).Stream,e=c(28354),f=c(94519),g=c(78829),h=c(50501),i=function(a){a=a||{},f.validateOptions(a,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var b=a.headers;if(b)for(var c in b)this._driver.setHeader(c,b[c]);var d=a.extensions;d&&[].concat(d).forEach(this._driver.addExtension,this._driver),this._ping=a.ping,this._pingId=0,this.readyState=i.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var e=this;this._driver.on("open",function(a){e._open()}),this._driver.on("message",function(a){e._receiveMessage(a.data)}),this._driver.on("close",function(a){e._beginClose(a.reason,a.code)}),this._driver.on("error",function(a){e._emitError(a.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){e.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){e._pingId+=1,e.ping(e._pingId.toString())},1e3*this._ping)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};e.inherits(i,d),i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.CLOSE_TIMEOUT=3e4;var j={write:function(a){return this.send(a)},end:function(a){void 0!==a&&this.send(a),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(a){return!(this.readyState>i.OPEN)&&(a instanceof Buffer||(a=String(a)),this._driver.messages.write(a))},ping:function(a,b){return!(this.readyState>i.OPEN)&&this._driver.ping(a,b)},close:function(a,b){if(void 0===a&&(a=1e3),void 0===b&&(b=""),1e3!==a&&(a<3e3||a>4999))throw Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+a+" is neither.");if(this.readyState<i.CLOSING){var c=this;this._closeTimer=setTimeout(function(){c._beginClose("",1006)},i.CLOSE_TIMEOUT)}this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING),this._driver.close(b,a)},_configureStream:function(){var a=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(b){this._stream.on(b,function(){a._finalizeClose()})},this),this._stream.on("error",function(b){a._emitError("Network error: "+a.url+": "+b.message),a._finalizeClose()})},_open:function(){if(this.readyState===i.CONNECTING){this.readyState=i.OPEN,this.protocol=this._driver.protocol||"";var a=new h("open");a.initEvent("open",!1,!1),this.dispatchEvent(a)}},_receiveMessage:function(a){if(this.readyState>i.OPEN)return!1;this.readable&&this.emit("data",a);var b=new h("message",{data:a});b.initEvent("message",!1,!1),this.dispatchEvent(b)},_emitError:function(a){if(!(this.readyState>=i.CLOSING)){var b=new h("error",{message:a});b.initEvent("error",!1,!1),this.dispatchEvent(b)}},_beginClose:function(a,b){this.readyState!==i.CLOSED&&(this.readyState=i.CLOSING,this._closeParams=[a,b],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==i.CLOSED){this.readyState=i.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var a=this._closeParams?this._closeParams[0]:"",b=new h("close",{code:this._closeParams?this._closeParams[1]:1006,reason:a});b.initEvent("close",!1,!1),this.dispatchEvent(b)}}};for(var k in j)i.prototype[k]=j[k];for(var l in g)i.prototype[l]=g[l];a.exports=i}};